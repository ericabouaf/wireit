var WireIt={defaultWireClass:"WireIt.BezierWire",wireClassFromXtype:function(a){return this.classFromXtype(a,this.defaultWireClass)},defaultTerminalClass:"WireIt.Terminal",terminalClassFromXtype:function(a){return this.classFromXtype(a,this.defaultTerminalClass)},defaultContainerClass:"WireIt.Container",containerClassFromXtype:function(a){return this.classFromXtype(a,this.defaultContainerClass)},classFromXtype:function(e,c){var d=(e||c).split(".");var a=window;for(var b=0;b<d.length;b++){a=a[d[b]]}if(!YAHOO.lang.isFunction(a)){throw new Error("WireIt unable to find klass from xtype: '"+e+"'")}return a},getIntStyle:function(b,a){var c=YAHOO.util.Dom.getStyle(b,a);return parseInt(c.substr(0,c.length-2),10)},sn:function(d,c,a){if(!d){return}var b;if(c){for(b in c){if(c.hasOwnProperty(b)){var e=c[b];if(typeof(e)=="function"){continue}if(b=="className"){b="class";d.className=e}if(e!==d.getAttribute(b)){if(e===false){d.removeAttribute(b)}else{d.setAttribute(b,e)}}}}}if(a){for(b in a){if(a.hasOwnProperty(b)){if(typeof(a[b])=="function"){continue}if(b==="float"){b="cssFloat"}if(d.style[b]!=a[b]){d.style[b]=a[b]}}}}},cn:function(a,c,b,e){var d=document.createElement(a);this.sn(d,c,b);if(e){d.innerHTML=e}return d},indexOf:YAHOO.lang.isFunction(Array.prototype.indexOf)?function(b,a){return a.indexOf(b)}:function(c,a){for(var b=0;b<a.length;b++){if(a[b]==c){return b}}return -1},compact:YAHOO.lang.isFunction(Array.prototype.compact)?function(a){return a.compact()}:function(a){var c=[];for(var b=0;b<a.length;b++){if(a[b]){c.push(a[b])}}return c}};WireIt.util={};(function(){var a=YAHOO.util.Event,b=YAHOO.env.ua;WireIt.CanvasElement=function(c){this.element=document.createElement("canvas");c.appendChild(this.element);if(typeof(G_vmlCanvasManager)!="undefined"){this.element=G_vmlCanvasManager.initElement(this.element)}};WireIt.CanvasElement.prototype={getContext:function(c){return this.element.getContext(c||"2d")},destroy:function(){var c=this.element;if(YAHOO.util.Dom.inDocument(c)){c.parentNode.removeChild(c)}a.purgeElement(c,true)},SetCanvasRegion:b.ie?function(g,f,e,c){var d=this.element;WireIt.sn(d,null,{left:g+"px",top:f+"px",width:e+"px",height:c+"px"});d.getContext("2d").clearRect(0,0,e,c);this.element=d}:((b.webkit||b.opera)?function(f,j,c,k){var d=this.element;var h=WireIt.cn("canvas",{className:d.className||d.getAttribute("class"),width:c,height:k},{left:f+"px",top:j+"px"});var i=a.getListeners(d);for(var e in i){if(i.hasOwnProperty(e)){var g=i[e];a.addListener(h,g.type,g.fn,g.obj,g.adjust)}}a.purgeElement(d);d.parentNode.replaceChild(h,d);this.element=h}:function(f,e,d,c){WireIt.sn(this.element,{width:d,height:c},{left:f+"px",top:e+"px"})})}})();WireIt.Wire=function(d,c,b,a){this.parentEl=b;this.terminal1=d;this.terminal2=c;this.eventMouseClick=new YAHOO.util.CustomEvent("eventMouseClick");this.eventMouseIn=new YAHOO.util.CustomEvent("eventMouseIn");this.eventMouseOut=new YAHOO.util.CustomEvent("eventMouseOut");this.eventMouseMove=new YAHOO.util.CustomEvent("eventMouseMove");this.setOptions(a||{});WireIt.Wire.superclass.constructor.call(this,this.parentEl);YAHOO.util.Dom.addClass(this.element,this.className);if(this.label){this.renderLabel()}this.terminal1.addWire(this);this.terminal2.addWire(this)};YAHOO.lang.extend(WireIt.Wire,WireIt.CanvasElement,{xtype:"WireIt.Wire",className:"WireIt-Wire",cap:"round",bordercap:"round",width:3,borderwidth:1,color:"rgb(173, 216, 230)",bordercolor:"#0000ff",label:null,labelStyle:null,labelEditor:null,setOptions:function(b){for(var a in b){if(b.hasOwnProperty(a)){this[a]=b[a]}}},remove:function(){this.parentEl.removeChild(this.element);if(this.terminal1&&this.terminal1.removeWire){this.terminal1.removeWire(this)}if(this.terminal2&&this.terminal2.removeWire){this.terminal2.removeWire(this)}this.terminal1=null;this.terminal2=null;if(this.labelEl){if(this.labelField){this.labelField.destroy()}this.labelEl.innerHTML=""}},getOtherTerminal:function(a){return(a==this.terminal1)?this.terminal2:this.terminal1},draw:function(){var e=[4,4];var h=this.terminal1.getXY();var g=this.terminal2.getXY();var d=[Math.min(h[0],g[0])-e[0],Math.min(h[1],g[1])-e[1]];var b=[Math.max(h[0],g[0])+e[0],Math.max(h[1],g[1])+e[1]];this.min=d;this.max=b;var f=Math.abs(b[0]-d[0]);var c=Math.abs(b[1]-d[1]);h[0]=h[0]-d[0];h[1]=h[1]-d[1];g[0]=g[0]-d[0];g[1]=g[1]-d[1];this.SetCanvasRegion(d[0],d[1],f,c);var a=this.getContext();a.lineCap=this.bordercap;a.strokeStyle=this.bordercolor;a.lineWidth=this.width+this.borderwidth*2;a.beginPath();a.moveTo(h[0],h[1]);a.lineTo(g[0],g[1]);a.stroke();a.lineCap=this.cap;a.strokeStyle=this.color;a.lineWidth=this.width;a.beginPath();a.moveTo(h[0],h[1]);a.lineTo(g[0],g[1]);a.stroke()},redraw:function(){this.draw();if(this.label){this.positionLabel()}},renderLabel:function(){this.labelEl=WireIt.cn("div",{className:"WireIt-Wire-Label"},this.labelStyle);if(this.labelEditor){this.labelField=new inputEx.InPlaceEdit({parentEl:this.labelEl,editorField:this.labelEditor,animColors:{from:"#FFFF99",to:"#DDDDFF"}});this.labelField.setValue(this.label)}else{this.labelEl.innerHTML=this.label}this.element.parentNode.appendChild(this.labelEl)},setLabel:function(a){if(this.labelEditor){this.labelField.setValue(a)}else{this.labelEl.innerHTML=a}},positionLabel:function(){YAHOO.util.Dom.setStyle(this.labelEl,"left",(this.min[0]+this.max[0]-this.labelEl.clientWidth)/2+"px");YAHOO.util.Dom.setStyle(this.labelEl,"top",(this.min[1]+this.max[1]-this.labelEl.clientHeight)/2+"px")},wireDrawnAt:function(b,e){var a=this.getContext();var d=a.getImageData(b,e,1,1);var c=d.data;return !(c[0]===0&&c[1]===0&&c[2]===0&&c[3]===0)},onMouseMove:function(a,b){if(this.mouseInState===undefined){this.mouseInState=false}if(this.wireDrawnAt(a,b)){if(!this.mouseInState){this.mouseInState=true;this.onWireIn(a,b)}this.onWireMove(a,b)}else{if(this.mouseInState){this.mouseInState=false;this.onWireOut(a,b)}}},onWireMove:function(a,b){this.eventMouseMove.fire(this,[a,b])},onWireIn:function(a,b){this.eventMouseIn.fire(this,[a,b])},onWireOut:function(a,b){this.eventMouseOut.fire(this,[a,b])},onClick:function(a,b){if(this.wireDrawnAt(a,b)){this.onWireClick(a,b)}},onWireClick:function(a,b){this.eventMouseClick.fire(this,[a,b])},getConfig:function(){var a={xtype:this.xtype};if(this.labelEditor){a.label=this.labelField.getValue()}return a}});WireIt.StepWire=function(d,c,b,a){WireIt.StepWire.superclass.constructor.call(this,d,c,b,a)};YAHOO.lang.extend(WireIt.StepWire,WireIt.Wire,{xtype:"WireIt.StepWire",draw:function(){var b=[4,4];var h=this.terminal1.getXY();var g=this.terminal2.getXY();var c=[Math.min(h[0],g[0])-b[0],Math.min(h[1],g[1])-b[1]];var e=[Math.max(h[0],g[0])+b[0],Math.max(h[1],g[1])+b[1]];var a=Math.abs(e[0]-c[0]);var i=Math.abs(e[1]-c[1]);h[0]=h[0]-c[0];h[1]=h[1]-c[1];g[0]=g[0]-c[0];g[1]=g[1]-c[1];var f=[g[0],g[1]];g[1]=h[1];this.SetCanvasRegion(c[0],c[1],a,i);var d=this.getContext();d.lineCap=this.bordercap;d.strokeStyle=this.bordercolor;d.lineWidth=this.width+this.borderwidth*2;d.beginPath();d.moveTo(h[0],h[1]);d.lineTo(g[0],g[1]);d.lineTo(f[0],f[1]);d.stroke();d.lineCap=this.cap;d.strokeStyle=this.color;d.lineWidth=this.width;d.beginPath();d.moveTo(h[0],h[1]);d.lineTo(g[0],g[1]);d.lineTo(f[0],f[1]);d.stroke()}});WireIt.ArrowWire=function(d,c,b,a){WireIt.ArrowWire.superclass.constructor.call(this,d,c,b,a)};YAHOO.lang.extend(WireIt.ArrowWire,WireIt.Wire,{xtype:"WireIt.ArrowWire",draw:function(){var L=7;var g=L+3;var D=[4+g,4+g];var e=this.terminal1.getXY();var c=this.terminal2.getXY();var j=Math.sqrt(Math.pow(e[0]-c[0],2)+Math.pow(e[1]-c[1],2));var H=[Math.min(e[0],c[0])-D[0],Math.min(e[1],c[1])-D[1]];var I=[Math.max(e[0],c[0])+D[0],Math.max(e[1],c[1])+D[1]];this.min=H;this.max=I;var k=Math.abs(I[0]-H[0])+g;var x=Math.abs(I[1]-H[1])+g;e[0]=e[0]-H[0];e[1]=e[1]-H[1];c[0]=c[0]-H[0];c[1]=c[1]-H[1];this.SetCanvasRegion(H[0],H[1],k,x);var n=this.getContext();n.lineCap=this.bordercap;n.strokeStyle=this.bordercolor;n.lineWidth=this.width+this.borderwidth*2;n.beginPath();n.moveTo(e[0],e[1]);n.lineTo(c[0],c[1]);n.stroke();n.lineCap=this.cap;n.strokeStyle=this.color;n.lineWidth=this.width;n.beginPath();n.moveTo(e[0],e[1]);n.lineTo(c[0],c[1]);n.stroke();var s=e;var r=c;var q=[0,0];var m=20;var v=(j===0)?0:1-(m/j);q[0]=Math.abs(s[0]+v*(r[0]-s[0]));q[1]=Math.abs(s[1]+v*(r[1]-s[1]));var O,N;var i=s[0]-r[0];var w=s[1]-r[1];var u=s[0]*r[1]-s[1]*r[0];if(i!==0){O=w/i;N=u/i}else{O=0}var l,p;if(O===0){l=0}else{l=-1/O}p=q[1]-l*q[0];var F=1+Math.pow(l,2);var E=2*l*p-2*q[0]-2*q[1]*l;var y=-2*q[1]*p+Math.pow(q[0],2)+Math.pow(q[1],2)-Math.pow(L,2)+Math.pow(p,2);var M=Math.pow(E,2)-4*F*y;if(M<0){return}var K=(-E+Math.sqrt(M))/(2*F);var J=(-E-Math.sqrt(M))/(2*F);var h=l*K+p;var f=l*J+p;if(s[1]==r[1]){var G=(s[0]>r[0])?1:-1;K=r[0]+G*m;J=K;h-=L;f+=L}n.fillStyle=this.color;n.beginPath();n.moveTo(r[0],r[1]);n.lineTo(K,h);n.lineTo(J,f);n.fill();n.strokeStyle=this.bordercolor;n.lineWidth=this.borderwidth;n.beginPath();n.moveTo(r[0],r[1]);n.lineTo(K,h);n.lineTo(J,f);n.lineTo(r[0],r[1]);n.stroke()}});WireIt.BezierWire=function(d,c,b,a){WireIt.BezierWire.superclass.constructor.call(this,d,c,b,a)};YAHOO.lang.extend(WireIt.BezierWire,WireIt.Wire,{xtype:"WireIt.BezierWire",coeffMulDirection:100,draw:function(){var q=this.terminal1.getXY();var n=this.terminal2.getXY();var f=this.coeffMulDirection;var b=Math.sqrt(Math.pow(q[0]-n[0],2)+Math.pow(q[1]-n[1],2));if(b<f){f=b/2}var c=[this.terminal1.direction[0]*f,this.terminal1.direction[1]*f];var a=[this.terminal2.direction[0]*f,this.terminal2.direction[1]*f];var m=[];m[0]=q;m[1]=[q[0]+c[0],q[1]+c[1]];m[2]=[n[0]+a[0],n[1]+a[1]];m[3]=n;var h=[q[0],q[1]];var l=[q[0],q[1]];for(var j=1;j<m.length;j++){var d=m[j];if(d[0]<h[0]){h[0]=d[0]}if(d[1]<h[1]){h[1]=d[1]}if(d[0]>l[0]){l[0]=d[0]}if(d[1]>l[1]){l[1]=d[1]}}var g=[4,4];h[0]=h[0]-g[0];h[1]=h[1]-g[1];l[0]=l[0]+g[0];l[1]=l[1]+g[1];var e=Math.abs(l[0]-h[0]);var o=Math.abs(l[1]-h[1]);this.min=h;this.max=l;this.SetCanvasRegion(h[0],h[1],e,o);var k=this.getContext();for(j=0;j<m.length;j++){m[j][0]=m[j][0]-h[0];m[j][1]=m[j][1]-h[1]}k.lineCap=this.bordercap;k.strokeStyle=this.bordercolor;k.lineWidth=this.width+this.borderwidth*2;k.beginPath();k.moveTo(m[0][0],m[0][1]);k.bezierCurveTo(m[1][0],m[1][1],m[2][0],m[2][1],m[3][0],m[3][1]);k.stroke();k.lineCap=this.cap;k.strokeStyle=this.color;k.lineWidth=this.width;k.beginPath();k.moveTo(m[0][0],m[0][1]);k.bezierCurveTo(m[1][0],m[1][1],m[2][0],m[2][1],m[3][0],m[3][1]);k.stroke()}});WireIt.BezierArrowWire=function(d,c,b,a){WireIt.BezierArrowWire.superclass.constructor.call(this,d,c,b,a)};YAHOO.lang.extend(WireIt.BezierArrowWire,WireIt.BezierWire,{xtype:"WireIt.BezierArrowWire",draw:function(){var e=Math.round(this.width*1.5+20);var u=Math.round(this.width*1.2+20);var S=e/2;var g=S+3;var f=[4+g,4+g];var R=this.terminal1.getXY();var Q=this.terminal2.getXY();var X=this.coeffMulDirection;var s=Math.sqrt(Math.pow(R[0]-Q[0],2)+Math.pow(R[1]-Q[1],2));if(s<X){X=s/2}var N=[this.terminal1.direction[0]*X,this.terminal1.direction[1]*X];var M=[this.terminal2.direction[0]*X,this.terminal2.direction[1]*X];var r=[];r[0]=R;r[1]=[R[0]+N[0],R[1]+N[1]];r[2]=[Q[0]+M[0],Q[1]+M[1]];r[3]=Q;var T=[R[0],R[1]];var v=[R[0],R[1]];for(var P=1;P<r.length;P++){var J=r[P];if(J[0]<T[0]){T[0]=J[0]}if(J[1]<T[1]){T[1]=J[1]}if(J[0]>v[0]){v[0]=J[0]}if(J[1]>v[1]){v[1]=J[1]}}T[0]=T[0]-f[0];T[1]=T[1]-f[1];v[0]=v[0]+f[0];v[1]=v[1]+f[1];var w=Math.abs(v[0]-T[0]);var F=Math.abs(v[1]-T[1]);this.min=T;this.max=v;this.SetCanvasRegion(T[0],T[1],w,F);var L=this.getContext();for(P=0;P<r.length;P++){r[P][0]=r[P][0]-T[0];r[P][1]=r[P][1]-T[1]}L.lineCap=this.bordercap;L.strokeStyle=this.bordercolor;L.lineWidth=this.width+this.borderwidth*2;L.beginPath();L.moveTo(r[0][0],r[0][1]);L.bezierCurveTo(r[1][0],r[1][1],r[2][0],r[2][1],r[3][0],r[3][1]+u/2*this.terminal2.direction[1]);L.stroke();L.lineCap=this.cap;L.strokeStyle=this.color;L.lineWidth=this.width;L.beginPath();L.moveTo(r[0][0],r[0][1]);L.bezierCurveTo(r[1][0],r[1][1],r[2][0],r[2][1],r[3][0],r[3][1]+u/2*this.terminal2.direction[1]);L.stroke();var E=r[2],D=Q;var H=[0,0];var h=u;var I=1-(h/s);H[0]=Math.abs(E[0]+I*(D[0]-E[0]));H[1]=Math.abs(E[1]+I*(D[1]-E[1]));var V,U;var c=E[0]-D[0];var y=E[1]-D[1];var x=E[0]*D[1]-E[1]*D[0];if(c!==0){V=y/c;U=x/c}else{V=0}var q,O;if(V===0){q=0}else{q=-1/V}O=H[1]-q*H[0];var m=1+Math.pow(q,2),k=2*q*O-2*H[0]-2*H[1]*q,j=-2*H[1]*O+Math.pow(H[0],2)+Math.pow(H[1],2)-Math.pow(S,2)+Math.pow(O,2),G=Math.pow(k,2)-4*m*j;if(G<0){return false}var n=(-k+Math.sqrt(G))/(2*m),l=(-k-Math.sqrt(G))/(2*m),Z=q*n+O,Y=q*l+O;if(E[1]==D[1]){var K=(E[0]>D[0])?1:-1;n=D[0]+K*h;l=n;Z-=S;Y+=S}L.fillStyle=this.color;L.beginPath();L.moveTo(D[0],D[1]);L.lineTo(n,Z);L.lineTo(l,Y);L.fill();L.strokeStyle=this.bordercolor;L.lineWidth=this.borderwidth;L.beginPath();L.moveTo(D[0],D[1]);L.lineTo(n,Z);L.lineTo(l,Y);L.lineTo(D[0],D[1]);L.stroke();return[R,Q,E,D]}});(function(){var a=YAHOO.util;var c=YAHOO.lang,b="WireIt-";WireIt.TerminalProxy=function(e,d){this.terminal=e;this.termConfig=d||{};this.terminalProxySize=d.terminalProxySize||10;this.fakeTerminal=null;WireIt.TerminalProxy.superclass.constructor.call(this,this.terminal.el,undefined,{dragElId:"WireIt-TerminalProxy",resizeFrame:false,centerFrame:true})};a.DDM.mode=a.DDM.INTERSECT;c.extend(WireIt.TerminalProxy,YAHOO.util.DDProxy,{createFrame:function(){var e=this,d=document.body;if(!d||!d.firstChild){window.setTimeout(function(){e.createFrame()},50);return}var h=this.getDragEl(),g=YAHOO.util.Dom;if(!h){h=WireIt.cn("div",{id:this.dragElId},{position:"absolute",visibility:"hidden",cursor:"move",border:"2px solid #aaa",zIndex:999,height:this.terminalProxySize+"px",width:this.terminalProxySize+"px"});var f=WireIt.cn("div",{},{height:"100%",width:"100%",backgroundColor:"#ccc",opacity:"0"});h.appendChild(f);d.insertBefore(h,d.firstChild)}},startDrag:function(){if(this.terminal.nMaxWires==1&&this.terminal.wires.length==1){this.terminal.wires[0].remove()}else{if(this.terminal.wires.length>=this.terminal.nMaxWires){return}}var e=this.terminalProxySize/2;this.fakeTerminal={direction:this.terminal.fakeDirection,pos:[200,200],addWire:function(){},removeWire:function(){},getXY:function(){var g=YAHOO.util.Dom.getElementsByClassName("WireIt-Layer");if(g.length>0){var h=YAHOO.util.Dom.getXY(g[0]);return[this.pos[0]-h[0]+e,this.pos[1]-h[1]+e]}return this.pos}};var f=this.terminal.parentEl.parentNode;if(this.terminal.container){f=this.terminal.container.layer.el}var d=WireIt.wireClassFromXtype(this.terminal.editingWireConfig.xtype);this.editingWire=new d(this.terminal,this.fakeTerminal,f,this.terminal.editingWireConfig);YAHOO.util.Dom.addClass(this.editingWire.element,b+"Wire-editing")},onDrag:function(g){if(!this.editingWire){return}if(this.terminal.container){var f=this.terminal.container.layer.el;var h=0;var d=0;if(f.offsetParent){do{h+=f.scrollLeft;d+=f.scrollTop;f=f.offsetParent}while(f)}this.fakeTerminal.pos=[g.clientX+h,g.clientY+d]}else{this.fakeTerminal.pos=(YAHOO.env.ua.ie)?[g.clientX,g.clientY]:[g.clientX+window.pageXOffset,g.clientY+window.pageYOffset]}this.editingWire.redraw()},endDrag:function(d){if(this.editingWire){this.editingWire.remove();this.editingWire=null}},onDragEnter:function(g,d){if(!this.editingWire){return}for(var f=0;f<d.length;f++){if(this.isValidWireTerminal(d[f])){d[f].terminal.setDropInvitation(true)}}},onDragOut:function(g,d){if(!this.editingWire){return}for(var f=0;f<d.length;f++){if(this.isValidWireTerminal(d[f])){d[f].terminal.setDropInvitation(false)}}},onDragDrop:function(n,l){var j;if(!this.editingWire){return}this.onDragOut(n,l);var p=null;for(j=0;j<l.length;j++){if(this.isValidWireTerminal(l[j])){p=l[j];break}}if(!p){return}this.editingWire.remove();this.editingWire=null;var h=false;for(j=0;j<this.terminal.wires.length;j++){if(this.terminal.wires[j].terminal1==this.terminal){if(this.terminal.wires[j].terminal2==p.terminal){h=true;break}}else{if(this.terminal.wires[j].terminal2==this.terminal){if(this.terminal.wires[j].terminal1==p.terminal){h=true;break}}}}if(h){return}var k=this.terminal.parentEl.parentNode;if(this.terminal.container){k=this.terminal.container.layer.el}var g=this.terminal;var f=p.terminal;if(f.alwaysSrc){g=p.terminal;f=this.terminal}var m=WireIt.wireClassFromXtype(g.wireConfig.xtype);var d=p.terminal,o;if(d.nMaxWires==1){if(d.wires.length>0){d.wires[0].remove()}o=new m(g,f,k,g.wireConfig);o.redraw()}else{if(d.wires.length<d.nMaxWires){o=new m(g,f,k,g.wireConfig);o.redraw()}}},isWireItTerminal:true,isValidWireTerminal:function(d){if(!d.isWireItTerminal){return false}if(this.termConfig.type){if(this.termConfig.allowedTypes){if(WireIt.indexOf(d.termConfig.type,this.termConfig.allowedTypes)==-1){return false}}else{if(this.termConfig.type!=d.termConfig.type){return false}}}else{if(d.termConfig.type){if(d.termConfig.allowedTypes){if(WireIt.indexOf(this.termConfig.type,d.termConfig.allowedTypes)==-1){return false}}else{if(this.termConfig.type!=d.termConfig.type){return false}}}}if(this.terminal.container){if(this.terminal.container.preventSelfWiring){if(d.terminal.container==this.terminal.container){return false}}}return true}})})();(function(){var b=YAHOO.util;var a=b.Event,d=YAHOO.lang,c="WireIt-";WireIt.Scissors=function(e,f){WireIt.Scissors.superclass.constructor.call(this,document.createElement("div"),f);this._terminal=e;this.initScissors()};WireIt.Scissors.visibleInstance=null;d.extend(WireIt.Scissors,YAHOO.util.Element,{initScissors:function(){this.hideNow();this.addClass(c+"Wire-scissors");this.appendTo(this._terminal.container?this._terminal.container.layer.el:this._terminal.el.parentNode.parentNode);this.on("mouseover",this.show,this,true);this.on("mouseout",this.hide,this,true);this.on("click",this.scissorClick,this,true);a.addListener(this._terminal.el,"mouseover",this.mouseOver,this,true);a.addListener(this._terminal.el,"mouseout",this.hide,this,true)},setPosition:function(){var e=this._terminal.getXY();this.setStyle("left",(e[0]+this._terminal.direction[0]*30-8)+"px");this.setStyle("top",(e[1]+this._terminal.direction[1]*30-8)+"px")},mouseOver:function(){if(this._terminal.wires.length>0){this.show()}},scissorClick:function(){this._terminal.removeAllWires();if(this.terminalTimeout){this.terminalTimeout.cancel()}this.hideNow()},show:function(){this.setPosition();this.setStyle("display","");if(WireIt.Scissors.visibleInstance&&WireIt.Scissors.visibleInstance!=this){if(WireIt.Scissors.visibleInstance.terminalTimeout){WireIt.Scissors.visibleInstance.terminalTimeout.cancel()}WireIt.Scissors.visibleInstance.hideNow()}WireIt.Scissors.visibleInstance=this;if(this.terminalTimeout){this.terminalTimeout.cancel()}},hide:function(){this.terminalTimeout=YAHOO.lang.later(700,this,this.hideNow)},hideNow:function(){WireIt.Scissors.visibleInstance=null;this.setStyle("display","none")}})})();(function(){var b=YAHOO.util;var a=b.Event,e=YAHOO.lang,c=b.Dom,d="WireIt-";WireIt.Terminal=function(h,g,f){this.name=null;this.parentEl=h;this.container=f;this.wires=[];this.setOptions(g);this.eventAddWire=new b.CustomEvent("eventAddWire");this.eventRemoveWire=new b.CustomEvent("eventRemoveWire");this.el=null;this.render();if(this.editable){this.dd=new WireIt.TerminalProxy(this,this.ddConfig);this.scissors=new WireIt.Scissors(this)}};WireIt.Terminal.prototype={xtype:"WireIt.Terminal",direction:[0,1],fakeDirection:[0,-1],editable:true,nMaxWires:Infinity,wireConfig:{},editingWireConfig:{},className:"WireIt-Terminal",connectedClassName:"WireIt-Terminal-connected",dropinviteClassName:"WireIt-Terminal-dropinvite",offsetPosition:null,alwaysSrc:false,ddConfig:false,setOptions:function(g){for(var f in g){if(g.hasOwnProperty(f)){this[f]=g[f]}}if(g.direction&&!g.fakeDirection){this.fakeDirection=[-g.direction[0],-g.direction[1]]}if(g.wireConfig&&!g.editingWireConfig){this.editingWireConfig=this.wireConfig}},setDropInvitation:function(f){if(f){c.addClass(this.el,this.dropinviteClassName)}else{c.removeClass(this.el,this.dropinviteClassName)}},render:function(){this.el=WireIt.cn("div",{className:this.className});if(this.name){this.el.title=this.name}this.setPosition(this.offsetPosition);this.parentEl.appendChild(this.el)},setPosition:function(g){if(g){this.el.style.left="";this.el.style.top="";this.el.style.right="";this.el.style.bottom="";if(e.isArray(g)){this.el.style.left=g[0]+"px";this.el.style.top=g[1]+"px"}else{if(e.isObject(g)){for(var f in g){if(g.hasOwnProperty(f)&&g[f]!==""){this.el.style[f]=g[f]+"px"}}}}}},addWire:function(f){this.wires.push(f);c.addClass(this.el,this.connectedClassName);this.eventAddWire.fire(f)},removeWire:function(g){var f=WireIt.indexOf(g,this.wires);if(f!=-1){this.wires[f].destroy();this.wires[f]=null;this.wires=WireIt.compact(this.wires);if(this.wires.length===0){c.removeClass(this.el,this.connectedClassName)}this.eventRemoveWire.fire(g)}},getXY:function(){var g=this.container&&this.container.layer?this.container.layer.el:document.body;var h=this.el;var i=0,f=0;if(h.offsetParent){do{i+=h.offsetLeft;f+=h.offsetTop;h=h.offsetParent}while(!!h&&h!=g&&!YAHOO.util.Dom.hasClass(h,"WireIt-Layer"))}return[i+15,f+15]},remove:function(){while(this.wires.length>0){this.wires[0].remove()}this.parentEl.removeChild(this.el);a.purgeElement(this.el);if(this.scissors){a.purgeElement(this.scissors.get("element"))}},getConnectedTerminals:function(){var f=[];if(this.wires){for(var g=0;g<this.wires.length;g++){f.push(this.wires[g].getOtherTerminal(this))}}return f},redrawAllWires:function(){if(this.wires){for(var f=0;f<this.wires.length;f++){this.wires[f].redraw()}}},removeAllWires:function(){while(this.wires.length>0){this.wires[0].remove()}}}})();WireIt.util.TerminalInput=function(c,b,a){WireIt.util.TerminalInput.superclass.constructor.call(this,c,b,a)};YAHOO.lang.extend(WireIt.util.TerminalInput,WireIt.Terminal,{xtype:"WireIt.TerminalInput",direction:[0,-1],fakeDirection:[0,1],nMaxWires:1,ddConfig:{type:"input",allowedTypes:["output"]}});WireIt.util.TerminalOutput=function(c,b,a){WireIt.util.TerminalOutput.superclass.constructor.call(this,c,b,a)};YAHOO.lang.extend(WireIt.util.TerminalOutput,WireIt.Terminal,{xtype:"WireIt.TerminalOutput",direction:[0,1],fakeDirection:[0,-1],ddConfig:{type:"output",allowedTypes:["input"]},alwaysSrc:true});WireIt.util.DD=function(d,c,a,b){if(!d){throw new Error("WireIt.util.DD needs at least terminals and id")}this._WireItTerminals=d;WireIt.util.DD.superclass.constructor.call(this,c,a,b)};YAHOO.extend(WireIt.util.DD,YAHOO.util.DD,{onDrag:function(c){var a=YAHOO.lang.isArray(this._WireItTerminals)?this._WireItTerminals:(this._WireItTerminals.isWireItTerminal?[this._WireItTerminals]:[]);for(var b=0;b<a.length;b++){a[b].redrawAllWires()}},setTerminals:function(a){this._WireItTerminals=a}});WireIt.util.DDResize=function(a,b){this.myConf=b||{};this.myConf.container=a;this.myConf.minWidth=this.myConf.minWidth||50;this.myConf.minHeight=this.myConf.minHeight||50;WireIt.util.DDResize.superclass.constructor.apply(this,[a.el,a.ddResizeHandle]);this.setHandleElId(a.ddResizeHandle);this.eventResize=new YAHOO.util.CustomEvent("eventResize")};YAHOO.extend(WireIt.util.DDResize,YAHOO.util.DragDrop,{onMouseDown:function(b){var a=this.getEl();this.startWidth=a.offsetWidth;this.startHeight=a.offsetHeight;this.startPos=[YAHOO.util.Event.getPageX(b),YAHOO.util.Event.getPageY(b)]},onDrag:function(g){var d=[YAHOO.util.Event.getPageX(g),YAHOO.util.Event.getPageY(g)];var a=d[0]-this.startPos[0];var h=d[1]-this.startPos[1];var f=Math.max(this.startWidth+a,this.myConf.minWidth);var c=Math.max(this.startHeight+h,this.myConf.minHeight);var b=this.getEl();b.style.width=f+"px";b.style.height=c+"px";this.myConf.container.redrawAllWires();this.eventResize.fire([f,c])}});(function(){var b=YAHOO.util;var c=b.Dom,a=b.Event,d="WireIt-";WireIt.Container=function(e,f){this.setOptions(e);this.layer=f;this.terminals=[];this.wires=[];this.el=null;this.bodyEl=null;this.eventAddWire=new b.CustomEvent("eventAddWire");this.eventRemoveWire=new b.CustomEvent("eventRemoveWire");this.eventFocus=new b.CustomEvent("eventFocus");this.eventBlur=new b.CustomEvent("eventBlur");this.render();if(e.terminals){this.initTerminals(e.terminals)}if(this.resizable){this.makeResizable()}if(this.draggable){this.makeDraggable()}};WireIt.Container.prototype={xtype:"WireIt.Container",draggable:true,position:[100,100],className:d+"Container",ddHandle:true,ddHandleClassName:d+"Container-ddhandle",resizable:true,resizeHandleClassName:d+"Container-resizehandle",close:true,closeButtonClassName:d+"Container-closebutton",groupable:true,preventSelfWiring:true,title:null,icon:null,width:null,height:null,setOptions:function(f){for(var e in f){if(f.hasOwnProperty(e)){this[e]=f[e]}}},makeResizable:function(){this.ddResize=new WireIt.util.DDResize(this);this.ddResize.eventResize.subscribe(this.onResize,this,true)},setXYContraints:function(){if(this.layer){var e=c.getXY(this.layer.el);var f=c.getXY(this.el);this.dd.setXConstraint(f[0]-e[0]);this.dd.setYConstraint(f[1]-e[1])}},makeDraggable:function(){this.dd=new WireIt.util.DD(this.terminals,this.el);YAHOO.util.Event.on(window,"resize",this.setXYContraints,this,true);this.setXYContraints();this.dd.setXConstraint(this.position[0]);this.dd.setYConstraint(this.position[1]);if(this.ddHandle){this.dd.setHandleElId(this.ddHandle)}if(this.resizable){this.dd.addInvalidHandleId(this.ddResizeHandle);this.ddResize.addInvalidHandleId(this.ddHandle)}},onResize:function(g,e){var f=e[0];WireIt.sn(this.bodyEl,null,{width:(f[0]-14)+"px",height:(f[1]-(this.ddHandle?44:14))+"px"})},render:function(){this.el=WireIt.cn("div",{className:this.className});if(this.width){this.el.style.width=this.width+"px"}if(this.height){this.el.style.height=this.height+"px"}a.addListener(this.el,"mousedown",this.onMouseDown,this,true);if(this.ddHandle){this.ddHandle=WireIt.cn("div",{className:this.ddHandleClassName});this.el.appendChild(this.ddHandle);if(this.icon){var e=WireIt.cn("img",{src:this.icon,className:"WireIt-Container-icon"});this.ddHandle.appendChild(e)}if(this.title){this.ddHandle.appendChild(WireIt.cn("span",{className:"floatleft"},null,this.title))}}this.bodyEl=WireIt.cn("div",{className:"body"});this.el.appendChild(this.bodyEl);if(this.resizable){this.ddResizeHandle=WireIt.cn("div",{className:this.resizeHandleClassName});this.el.appendChild(this.ddResizeHandle)}if(this.close){this.closeButton=WireIt.cn("div",{className:this.closeButtonClassName});if(this.ddHandle){this.ddHandle.appendChild(this.closeButton)}else{this.el.appendChild(this.closeButton)}a.addListener(this.closeButton,"click",this.onCloseButton,this,true)}if(this.groupable&&this.ddHandle){this.groupButton=WireIt.cn("div",{className:"WireIt-Container-groupbutton"});this.ddHandle.appendChild(this.groupButton);a.addListener(this.groupButton,"click",this.onGroupButton,this,true)}this.layer.el.appendChild(this.el);this.el.style.left=this.position[0]+"px";this.el.style.top=this.position[1]+"px"},setBody:function(e){if(typeof e=="string"){this.bodyEl.innerHTML=e}else{this.bodyEl.innerHTML="";this.bodyEl.appendChild(e)}},onMouseDown:function(e){if(this.layer){if(this.layer.focusedContainer&&this.layer.focusedContainer!=this){this.layer.focusedContainer.removeFocus()}this.setFocus();this.layer.focusedContainer=this}},setFocus:function(){c.addClass(this.el,d+"Container-focused");this.eventFocus.fire(this)},removeFocus:function(){c.removeClass(this.el,d+"Container-focused");this.eventBlur.fire(this)},onCloseButton:function(g,f){a.stopEvent(g);this.layer.removeContainer(this)},highlight:function(){this.el.style.border="2px solid blue"},dehighlight:function(){this.el.style.border=""},superHighlight:function(){this.el.style.border="4px outset blue"},remove:function(){this.removeAllTerminals();this.layer.el.removeChild(this.el);a.purgeElement(this.el)},initTerminals:function(f){for(var e=0;e<f.length;e++){this.addTerminal(f[e])}},addTerminal:function(g){var e=WireIt.terminalClassFromXtype(g.xtype);var f=new e(this.el,g,this);this.terminals.push(f);f.eventAddWire.subscribe(this.onAddWire,this,true);f.eventRemoveWire.subscribe(this.onRemoveWire,this,true);return f},onAddWire:function(f,e){var g=e[0];if(WireIt.indexOf(g,this.wires)==-1){this.wires.push(g);this.eventAddWire.fire(g)}},onRemoveWire:function(g,f){var h=f[0];var e=WireIt.indexOf(h,this.wires);if(e!=-1){this.eventRemoveWire.fire(h);this.wires[e]=null}this.wires=WireIt.compact(this.wires)},removeAllTerminals:function(){for(var e=0;e<this.terminals.length;e++){this.terminals[e].remove()}this.terminals=[]},redrawAllWires:function(){for(var e=0;e<this.terminals.length;e++){this.terminals[e].redrawAllWires()}},getXY:function(){var f=c.getXY(this.el);if(this.layer){var e=c.getXY(this.layer.el);f[0]-=e[0];f[1]-=e[1];f[0]+=this.layer.el.scrollLeft;f[1]+=this.layer.el.scrollTop}return f},getConfig:function(){return{position:this.getXY(),xtype:this.xtype}},getValue:function(){return{}},setValue:function(e){},getTerminal:function(e){var g;for(var f=0;f<this.terminals.length;f++){g=this.terminals[f];if(g.name==e){return g}}return null}}})();WireIt.Layer=function(b){this.setOptions(b);this.containers=[];this.wires=[];this.groups=[];this.el=null;this.eventChanged=new YAHOO.util.CustomEvent("eventChanged");this.eventAddWire=new YAHOO.util.CustomEvent("eventAddWire");this.eventRemoveWire=new YAHOO.util.CustomEvent("eventRemoveWire");this.eventAddContainer=new YAHOO.util.CustomEvent("eventAddContainer");this.eventRemoveContainer=new YAHOO.util.CustomEvent("eventRemoveContainer");this.eventContainerDragged=new YAHOO.util.CustomEvent("eventContainerDragged");this.eventContainerResized=new YAHOO.util.CustomEvent("eventContainerResized");this.render();if(b.containers){this.initContainers(b.containers)}if(b.wires){this.initWires(b.wires)}if(this.layerMap){this.layermap=new WireIt.LayerMap(this,this.layerMapOptions)}if(WireIt.Grouper){this.grouper=new WireIt.Grouper(this,this.grouper.baseConfigFunction);var c=this.grouper.rubberband;this.el.onmousedown=function(d){return c.layerMouseDown.call(c,d)};var a=this.grouper;this.el.addEventListener("mouseup",function(d){c.finish();a.rubberbandSelect.call(a)},false)}};WireIt.Layer.prototype={className:"WireIt-Layer",parentEl:null,layerMap:false,layerMapOptions:null,enableMouseEvents:true,grouper:null,setOptions:function(b){for(var a in b){if(b.hasOwnProperty(a)){this[a]=b[a]}}if(!this.parentEl){this.parentEl=document.body}},render:function(){this.el=WireIt.cn("div",{className:this.className});this.parentEl.appendChild(this.el)},initContainers:function(b){for(var a=0;a<b.length;a++){this.addContainer(b[a])}},initWires:function(b){for(var a=0;a<b.length;a++){this.addWire(b[a])}},setSuperHighlighted:function(b){this.unsetSuperHighlighted();for(var a in b){if(b.hasOwnProperty(a)){b[a].superHighlight()}}this.superHighlighted=b},unsetSuperHighlighted:function(){if(YAHOO.lang.isValue(this.superHighlighted)){for(var a in this.superHighlighted){if(this.superHighlighted.hasOwnProperty(a)){this.superHighlighted[a].highlight()}}}this.superHighlighted=null},addWire:function(b){var a=WireIt.wireClassFromXtype(b.xtype);var e=b.src;var g=b.tgt;var f=this.containers[e.moduleId].getTerminal(e.terminal);var d=this.containers[g.moduleId].getTerminal(g.terminal);var c=new a(f,d,this.el,b);c.redraw();return c},addContainer:function(c){var a=WireIt.containerClassFromXtype(c.xtype);var b=new a(c,this);return this.addContainerDirect(b)},addContainerDirect:function(a){this.containers.push(a);a.eventAddWire.subscribe(this.onAddWire,this,true);a.eventRemoveWire.subscribe(this.onRemoveWire,this,true);if(a.ddResize){a.ddResize.on("endDragEvent",function(){this.eventContainerResized.fire(a);this.eventChanged.fire(this)},this,true)}if(a.dd){a.dd.on("endDragEvent",function(){this.eventContainerDragged.fire(a);this.eventChanged.fire(this)},this,true)}this.eventAddContainer.fire(a);this.eventChanged.fire(this);return a},removeContainer:function(a){var b=WireIt.indexOf(a,this.containers);if(b!=-1){a.remove();this.containers[b]=null;this.containers=WireIt.compact(this.containers);this.eventRemoveContainer.fire(a);this.eventChanged.fire(this)}},removeGroup:function(f,c){var a=this.groups.indexOf(f),b;if(a!=-1){this.groups.splice(a,1)}if(c){if(YAHOO.lang.isValue(f.groupContainer)){this.removeContainer(f.groupContainer)}else{for(b in f.containers){if(f.containers.hasOwnProperty(b)){var e=f.containers[b].container;this.removeContainer(e)}}for(b in f.groups){if(f.containers.hasOwnProperty(b)){var d=f.groups[b].group;this.removeGroup(d)}}}}},onAddWire:function(b,a){var c=a[0];if(WireIt.indexOf(c,this.wires)==-1){this.wires.push(c);if(this.enableMouseEvents){YAHOO.util.Event.addListener(c.element,"mousemove",this.onWireMouseMove,this,true);YAHOO.util.Event.addListener(c.element,"click",this.onWireClick,this,true)}this.eventAddWire.fire(c);this.eventChanged.fire(this)}},onRemoveWire:function(c,b){var d=b[0];var a=WireIt.indexOf(d,this.wires);if(a!=-1){this.wires[a]=null;this.wires=WireIt.compact(this.wires);this.eventRemoveWire.fire(d);this.eventChanged.fire(this)}},clear:function(){while(this.containers.length>0){this.removeContainer(this.containers[0])}},removeAllContainers:function(){this.clear()},getWiring:function(){var b;var c={containers:[],wires:[]};for(b=0;b<this.containers.length;b++){c.containers.push(this.containers[b].getConfig())}for(b=0;b<this.wires.length;b++){var d=this.wires[b];var a=d.getConfig();a.src={moduleId:WireIt.indexOf(d.terminal1.container,this.containers),terminal:d.terminal1.name};a.tgt={moduleId:WireIt.indexOf(d.terminal2.container,this.containers),terminal:d.terminal2.name};c.wires.push(a)}return c},setWiring:function(b){this.clear();var a;if(YAHOO.lang.isArray(b.containers)){for(a=0;a<b.containers.length;a++){this.addContainer(b.containers[a])}}if(YAHOO.lang.isArray(b.wires)){for(a=0;a<b.wires.length;a++){this.addWire(b.wires[a])}}},_getMouseEvtPos:function(b){var c=YAHOO.util.Event.getTarget(b);var a=[c.offsetLeft,c.offsetTop];return[a[0]+b.layerX,a[1]+b.layerY]},onWireClick:function(l){var d=this._getMouseEvtPos(l);var j=d[0],g=d[1],h=this.wires.length,m;for(var k=0;k<h;k++){m=this.wires[k];var f=m.element.offsetLeft,c=m.element.offsetTop;if(j>=f&&j<f+m.element.width&&g>=c&&g<c+m.element.height){var b=j-f,a=g-c;m.onClick(b,a)}}},onWireMouseMove:function(l){var d=this._getMouseEvtPos(l);var j=d[0],g=d[1],h=this.wires.length,m;for(var k=0;k<h;k++){m=this.wires[k];var f=m.element.offsetLeft,c=m.element.offsetTop;if(j>=f&&j<f+m.element.width&&g>=c&&g<c+m.element.height){var b=j-f,a=g-c;m.onMouseMove(b,a)}}}};(function(){var b=YAHOO.util.Dom,a=YAHOO.util.Event;WireIt.LayerMap=function(d,c){this.layer=d;this.setOptions(c);if(typeof c.parentEl=="string"){this.parentEl=YAHOO.util.Dom.get(c.parentEl)}else{if(this.layer&&!this.parentEl){this.parentEl=this.layer.el}}WireIt.LayerMap.superclass.constructor.call(this,this.parentEl);this.element.className=this.className;this.initEvents();this.draw()};YAHOO.lang.extend(WireIt.LayerMap,WireIt.CanvasElement,{className:"WireIt-LayerMap",style:"rgba(0, 0, 200, 0.5)",parentEl:null,lineWidth:2,setOptions:function(d){for(var c in d){if(d.hasOwnProperty(c)){this[c]=d[c]}}},initEvents:function(){var c=this.layer;a.addListener(this.element,"mousedown",this.onMouseDown,this,true);a.addListener(this.element,"mouseup",this.onMouseUp,this,true);a.addListener(this.element,"mousemove",this.onMouseMove,this,true);a.addListener(this.element,"mouseout",this.onMouseUp,this,true);c.eventAddWire.subscribe(this.draw,this,true);c.eventRemoveWire.subscribe(this.draw,this,true);c.eventAddContainer.subscribe(this.draw,this,true);c.eventRemoveContainer.subscribe(this.draw,this,true);c.eventContainerDragged.subscribe(this.draw,this,true);c.eventContainerResized.subscribe(this.draw,this,true);a.addListener(this.layer.el,"scroll",this.onLayerScroll,this,true)},onMouseMove:function(d,c){a.stopEvent(d);if(this.isMouseDown){this.scrollLayer(d.clientX,d.clientY)}},onMouseUp:function(d,c){a.stopEvent(d);this.isMouseDown=false},onMouseDown:function(d,c){a.stopEvent(d);this.scrollLayer(d.clientX,d.clientY);this.isMouseDown=true},scrollLayer:function(e,d){var p=b.getXY(this.element);var r=[e-p[0],d-p[1]];var h=b.getRegion(this.element);var g=h.right-h.left-4;var k=h.bottom-h.top-4;var f=this.layer.el.scrollWidth;var n=this.layer.el.scrollHeight;var i=Math.floor(100*g/f)/100;var o=Math.floor(100*k/n)/100;var c=[r[0]/i,r[1]/o];var q=b.getRegion(this.layer.el);var m=q.right-q.left;var j=q.bottom-q.top;var l=[Math.max(Math.floor(c[0]-m/2),0),Math.max(Math.floor(c[1]-j/2),0)];if(l[0]+m>f){l[0]=f-m}if(l[1]+j>n){l[1]=n-j}this.layer.el.scrollLeft=l[0];this.layer.el.scrollTop=l[1]},onLayerScroll:function(){if(this.scrollTimer){window.clearTimeout(this.scrollTimer)}var c=this;this.scrollTimer=window.setTimeout(function(){c.draw()},50)},draw:function(){var n=this.getContext();var e=b.getRegion(this.element);var d=e.right-e.left-4;var j=e.bottom-e.top-4;n.clearRect(0,0,d,j);var c=this.layer.el.scrollWidth;var l=this.layer.el.scrollHeight;var f=Math.floor(100*d/c)/100;var m=Math.floor(100*j/l)/100;var o=b.getRegion(this.layer.el);var k=o.right-o.left;var i=o.bottom-o.top;var h=this.layer.el.scrollLeft;var g=this.layer.el.scrollTop;n.strokeStyle="rgb(200, 50, 50)";n.lineWidth=1;n.strokeRect(h*f,g*m,k*f,i*m);n.fillStyle=this.style;n.strokeStyle=this.style;n.lineWidth=this.lineWidth;this.drawContainers(n,f,m);this.drawWires(n,f,m)},drawContainers:function(c,j,f){var h=this.layer.containers;var k=h.length,e,d=WireIt.getIntStyle,g;for(e=0;e<k;e++){g=h[e].el;c.fillRect(d(g,"left")*j,d(g,"top")*f,d(g,"width")*j,d(g,"height")*f)}},drawWires:function(g,d,f){var l=this.layer.wires;var c=l.length,e,j;for(e=0;e<c;e++){j=l[e];var k=j.terminal1.getXY(),h=j.terminal2.getXY();g.beginPath();g.moveTo(k[0]*d,k[1]*f);g.lineTo(h[0]*d,h[1]*f);g.closePath();g.stroke()}}})})();WireIt.ImageContainer=function(a,b){WireIt.ImageContainer.superclass.constructor.call(this,a,b)};YAHOO.lang.extend(WireIt.ImageContainer,WireIt.Container,{xtype:"WireIt.ImageContainer",resizable:false,ddHandle:false,className:"WireIt-Container WireIt-ImageContainer",image:null,render:function(){WireIt.ImageContainer.superclass.render.call(this);YAHOO.util.Dom.setStyle(this.bodyEl,"background-image","url("+this.image+")")}});WireIt.InOutContainer=function(a,b){WireIt.InOutContainer.superclass.constructor.call(this,a,b)};YAHOO.lang.extend(WireIt.InOutContainer,WireIt.Container,{xtype:"WireIt.InOutContainer",resizable:false,className:"WireIt-Container WireIt-InOutContainer",inputs:[],outputs:[],render:function(){WireIt.InOutContainer.superclass.render.call(this);for(var c=0;c<this.inputs.length;c++){var b=this.inputs[c];this.addTerminal({name:b,direction:[-1,0],offsetPosition:{left:-14,top:3+30*(c+1)},ddConfig:{type:"input",allowedTypes:["output"]}});this.bodyEl.appendChild(WireIt.cn("div",null,{lineHeight:"30px"},b))}for(c=0;c<this.outputs.length;c++){var a=this.outputs[c];this.addTerminal({name:a,direction:[1,0],offsetPosition:{right:-14,top:3+30*(c+1+this.inputs.length)},ddConfig:{type:"output",allowedTypes:["input"]},alwaysSrc:true});this.bodyEl.appendChild(WireIt.cn("div",null,{lineHeight:"30px",textAlign:"right"},a))}}});(function(){var a=YAHOO.lang;inputEx=function(b,d){var c=null,e;if(b.type){c=inputEx.getFieldClass(b.type);if(c===null){c=inputEx.StringField}}else{c=b.fieldClass?b.fieldClass:inputEx.StringField}if(a.isObject(b.inputParams)){e=new c(b.inputParams)}else{e=new c(b)}if(d){e.setParentField(d)}return e};a.augmentObject(inputEx,{VERSION:"0.7.0",spacerUrl:"images/space.gif",stateEmpty:"empty",stateRequired:"required",stateValid:"valid",stateInvalid:"invalid",messages:{required:"This field is required",invalid:"This field is invalid",valid:"This field is valid",defaultDateFormat:"m/d/Y",months:["January","February","March","April","May","June","July","August","September","October","November","December"],timeUnits:{SECOND:"seconds",MINUTE:"minutes",HOUR:"hours",DAY:"days",MONTH:"months",YEAR:"years"}},widget:{},mixin:{},regexps:{email:/^[a-z0-9!\#\$%&'\*\-\/=\?\+\-\^_`\{\|\}~]+(?:\.[a-z0-9!\#\$%&'\*\-\/=\?\+\-\^_`\{\|\}~]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z]{2,6}$/i,url:/^(http|https):\/\/[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(\:[0-9]{1,5})?(([0-9]{1,5})?\/.*)?$/i,password:/^[0-9a-zA-Z\x20-\x7E]*$/},typeClasses:{},browserAutocomplete:true,registerType:function(c,e,b,f){if(!a.isString(c)){throw new Error("inputEx.registerType: first argument must be a string")}if(!a.isFunction(e)){throw new Error("inputEx.registerType: second argument must be a function")}this.typeClasses[c]=e;var d=[];if(a.isArray(b)){d=b}if(e.superclass&&!f&&a.isArray(e.superclass.constructor.groupOptions)){d=e.superclass.constructor.groupOptions.concat(d)}e.groupOptions=d},getFieldClass:function(b){return a.isFunction(this.typeClasses[b])?this.typeClasses[b]:null},getType:function(b){for(var c in this.typeClasses){if(this.typeClasses.hasOwnProperty(c)){if(this.typeClasses[c]==b){return c}}}return null},buildField:function(b){return inputEx(b)},sn:function(e,d,b){if(!e){return}var c;if(d){for(c in d){var g=d[c];if(a.isFunction(g)){continue}if(c=="className"){c="class";e.className=g}if(g!==e.getAttribute(c)){try{if(g===false){e.removeAttribute(c)}else{e.setAttribute(c,g)}}catch(f){}}}}if(b){for(c in b){if(a.isFunction(b[c])){continue}if(e.style[c]!=b[c]){e.style[c]=b[c]}}}},cn:function(b,f,c,h){if(b=="input"&&YAHOO.env.ua.ie&&YAHOO.env.ua.ie<9){var e="<"+b;if(f!=="undefined"){for(var d in f){e+=" "+(d==="className"?"class":d)+'="'+f[d]+'"'}}e+="/>";return document.createElement(e)}else{var g=document.createElement(b);this.sn(g,f,c);if(h){g.innerHTML=h}return g}},indexOf:function(f,b,e){var c=b.length,d;if(!a.isFunction(e)){e=function(g,h){return g===h}}for(d=0;d<c;d++){if(e.call({},f,b[d])){return d}}return -1},compactArray:function(b){var e=[],c=b.length,d;for(d=0;d<c;d++){if(!a.isNull(b[d])&&!a.isUndefined(b[d])){e.push(b[d])}}return e},removeAccents:function(b){return b.replace(/[àáâãäå]/g,"a").replace(/[èéêë]/g,"e").replace(/[ìíîï]/g,"i").replace(/[òóôõö]/g,"o").replace(/[ùúûü]/g,"u").replace(/[ýÿ]/g,"y").replace(/[ñ]/g,"n").replace(/[ç]/g,"c").replace(/[œ]/g,"oe").replace(/[æ]/g,"ae")},htmlEntities:function(b){return b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}})})();YAHOO.inputEx=inputEx;(function(){var b=YAHOO.util.Dom,c=YAHOO.lang,a=YAHOO.util;inputEx.Field=function(d){this.setOptions(d||{});this.render();this.updatedEvt=new a.CustomEvent("updated",this);this.initEvents();if(!c.isUndefined(this.options.value)){this.setValue(this.options.value,false)}if(d.parentEl){if(c.isString(d.parentEl)){b.get(d.parentEl).appendChild(this.getEl())}else{d.parentEl.appendChild(this.getEl())}}};inputEx.Field.prototype={setOptions:function(d){this.options={};this.options.name=d.name;this.options.value=d.value;this.options.id=d.id||b.generateId();this.options.label=d.label;this.options.description=d.description;this.options.messages={};this.options.messages.required=(d.messages&&d.messages.required)?d.messages.required:inputEx.messages.required;this.options.messages.invalid=(d.messages&&d.messages.invalid)?d.messages.invalid:inputEx.messages.invalid;this.options.className=d.className?d.className:"inputEx-Field";this.options.required=c.isUndefined(d.required)?false:d.required;this.options.showMsg=c.isUndefined(d.showMsg)?false:d.showMsg},setFieldName:function(d){},render:function(){this.divEl=inputEx.cn("div",{className:"inputEx-fieldWrapper"});if(this.options.id){this.divEl.id=this.options.id}if(this.options.required){b.addClass(this.divEl,"inputEx-required")}if(YAHOO.lang.isString(this.options.label)){this.labelDiv=inputEx.cn("div",{id:this.divEl.id+"-label",className:"inputEx-label","for":this.divEl.id+"-field"});this.labelEl=inputEx.cn("label",null,null,this.options.label===""?"&nbsp;":this.options.label);this.labelDiv.appendChild(this.labelEl);this.divEl.appendChild(this.labelDiv)}this.fieldContainer=inputEx.cn("div",{className:this.options.className});this.renderComponent();if(this.options.description){this.fieldContainer.appendChild(inputEx.cn("div",{id:this.divEl.id+"-desc",className:"inputEx-description"},null,this.options.description))}this.divEl.appendChild(this.fieldContainer);this.divEl.appendChild(inputEx.cn("div",null,{clear:"both"}," "))},fireUpdatedEvt:function(){var d=this;setTimeout(function(){d.updatedEvt.fire(d.getValue(),d)},50)},renderComponent:function(){},getEl:function(){return this.divEl},initEvents:function(){},getValue:function(){},setValue:function(e,d){this.setClassFromState();if(d!==false){this.fireUpdatedEvt()}},setClassFromState:function(){var d;if(this.previousState){d="inputEx-"+((this.previousState==inputEx.stateRequired)?inputEx.stateInvalid:this.previousState);b.removeClass(this.divEl,d)}var e=this.getState();if(!(e==inputEx.stateEmpty&&b.hasClass(this.divEl,"inputEx-focused"))){d="inputEx-"+((e==inputEx.stateRequired)?inputEx.stateInvalid:e);b.addClass(this.divEl,d)}if(this.options.showMsg){this.displayMessage(this.getStateString(e))}this.previousState=e},getStateString:function(d){if(d==inputEx.stateRequired){return this.options.messages.required}else{if(d==inputEx.stateInvalid){return this.options.messages.invalid}else{return""}}},getState:function(){if(this.isEmpty()){return this.options.required?inputEx.stateRequired:inputEx.stateEmpty}return this.validate()?inputEx.stateValid:inputEx.stateInvalid},validate:function(){return true},onFocus:function(f){var d=this.getEl();b.removeClass(d,"inputEx-empty");b.addClass(d,"inputEx-focused")},onBlur:function(d){b.removeClass(this.getEl(),"inputEx-focused");this.setClassFromState()},onChange:function(d){this.fireUpdatedEvt()},close:function(){},disable:function(){},enable:function(){},isDisabled:function(){return false},focus:function(){},destroy:function(){var d=this.getEl();this.updatedEvt.unsubscribeAll();a.Event.purgeElement(d,true);if(b.inDocument(d)){d.parentNode.removeChild(d)}},displayMessage:function(g){if(!this.fieldContainer){return}if(!this.msgEl){this.msgEl=inputEx.cn("div",{className:"inputEx-message"});try{var d=this.divEl.getElementsByTagName("div");this.divEl.insertBefore(this.msgEl,d[(d.length-1>=0)?d.length-1:0])}catch(f){alert(f)}}this.msgEl.innerHTML=g},show:function(){this.divEl.style.display=""},hide:function(){this.divEl.style.display="none"},clear:function(d){this.setValue(c.isUndefined(this.options.value)?"":this.options.value,d)},isEmpty:function(){return this.getValue()===""},setParentField:function(d){this.parentField=d},getParentField:function(){return this.parentField}};inputEx.Field.groupOptions=[{type:"string",label:"Name",name:"name",value:"",required:true},{type:"string",label:"Label",name:"label",value:""},{type:"string",label:"Description",name:"description",value:""},{type:"boolean",label:"Required?",name:"required",value:false},{type:"boolean",label:"Show messages",name:"showMsg",value:false}]})();(function(){var a=YAHOO.lang;inputEx.BaseField=inputEx.Field;inputEx.Field=function(b){inputEx.Field.superclass.constructor.call(this,b)};a.extend(inputEx.Field,inputEx.BaseField,{setOptions:function(b){inputEx.Field.superclass.setOptions.call(this,b);this.options.wirable=a.isUndefined(b.wirable)?false:b.wirable;this.options.container=b.container},render:function(){inputEx.Field.superclass.render.call(this);if(this.options.wirable){this.renderTerminal()}},renderTerminal:function(){var b=inputEx.cn("div",{className:"WireIt-InputExTerminal"});this.divEl.insertBefore(b,this.fieldContainer);this.terminal=new WireIt.Terminal(b,{name:this.options.name,direction:[-1,0],fakeDirection:[0,1],ddConfig:{type:"input",allowedTypes:["output"]},nMaxWires:1},this.options.container);if(this.options.container){this.options.container.terminals.push(this.terminal)}this.terminal.eventAddWire.subscribe(this.onAddWire,this,true);this.terminal.eventRemoveWire.subscribe(this.onRemoveWire,this,true)},setContainer:function(b){this.options.container=b;if(this.terminal){this.terminal.container=b;if(WireIt.indexOf(this.terminal,b.terminals)==-1){b.terminals.push(this.terminal)}}},setFieldName:function(b){if(this.terminal){this.terminal.name=b;this.terminal.el.title=b}},onAddWire:function(b,c){this.options.container.onAddWire(b,c);this.disable();this.el.value="[wired]"},onRemoveWire:function(b,c){this.options.container.onRemoveWire(b,c);this.enable();this.el.value=""}});inputEx.Field.groupOptions=inputEx.BaseField.groupOptions.concat([{type:"boolean",label:"Wirable",name:"wirable",value:false}])})();WireIt.FormContainer=function(a,b){WireIt.FormContainer.superclass.constructor.call(this,a,b)};YAHOO.lang.extend(WireIt.FormContainer,WireIt.Container,{xtype:"WireIt.FormContainer",fields:[],legend:null,collapsible:false,render:function(){WireIt.FormContainer.superclass.render.call(this);this.renderForm()},renderForm:function(){var a={parentEl:this.bodyEl,fields:this.fields,legend:this.legend,collapsible:this.collapsible};this.form=new inputEx.Group(a);this.form.setContainer(this);for(var b=0;b<this.form.inputs.length;b++){var c=this.form.inputs[b];c.setContainer(this)}if(this.form.legend){YAHOO.util.Event.addListener(this.form.legend,"click",function(){var e=this;for(var d=0;d<this.form.inputs.length;d++){var f=this.form.inputs[d];if(f.terminal){f.terminal.getXY=function(){if(YAHOO.util.Dom.hasClass(e.form.fieldset,"inputEx-Collapsed")){return e.getXY()}else{return WireIt.Terminal.prototype.getXY.call(this)}}}}this.redrawAllWires()},this,true)}},getValue:function(){return this.form.getValue()},setValue:function(a){this.form.setValue(a)}});(function(){var c=YAHOO.lang,b=YAHOO.util.Dom,a=YAHOO.util.Event;inputEx.Group=function(d){inputEx.Group.superclass.constructor.call(this,d);if(!this.options.value){this.runFieldsInteractions()}};c.extend(inputEx.Group,inputEx.Field,{setOptions:function(d){inputEx.Group.superclass.setOptions.call(this,d);this.options.className=d.className||"inputEx-Group";this.options.fields=d.fields;this.options.flatten=d.flatten;this.options.legend=d.legend||"";this.options.collapsible=c.isUndefined(d.collapsible)?false:d.collapsible;this.options.collapsed=c.isUndefined(d.collapsed)?false:d.collapsed;this.options.disabled=c.isUndefined(d.disabled)?false:d.disabled;this.inputs=[];this.inputsNames={}},render:function(){this.divEl=inputEx.cn("div",{className:this.options.className});if(this.options.id){this.divEl.id=this.options.id}this.renderFields(this.divEl);if(this.options.disabled){this.disable()}},renderFields:function(f){this.fieldset=inputEx.cn("fieldset");this.legend=inputEx.cn("legend",{className:"inputEx-Group-legend"});if(this.options.collapsible){var g=inputEx.cn("div",{className:"inputEx-Group-collapseImg"},null," ");this.legend.appendChild(g);inputEx.sn(this.fieldset,{className:"inputEx-Expanded"})}if(!c.isUndefined(this.options.legend)&&this.options.legend!==""){this.legend.appendChild(inputEx.cn("span",null,null," "+this.options.legend))}if(this.options.collapsible||(!c.isUndefined(this.options.legend)&&this.options.legend!=="")){this.fieldset.appendChild(this.legend)}for(var e=0;e<this.options.fields.length;e++){var d=this.options.fields[e];if(!d){throw new Error("inputEx.Form: One of the provided fields is undefined ! (check trailing comma)")}this.addField(d)}if(this.options.collapsed){this.toggleCollapse()}f.appendChild(this.fieldset)},addField:function(d){var e=this.renderField(d);this.fieldset.appendChild(e.getEl())},renderField:function(e){var d=inputEx(e,this);this.inputs.push(d);if(d.options.name){this.inputsNames[d.options.name]=d}if(!this.hasInteractions&&e.interactions){this.hasInteractions=true}d.updatedEvt.subscribe(this.onChange,this,true);return d},initEvents:function(){if(this.options.collapsible){a.addListener(this.legend,"click",this.toggleCollapse,this,true)}},toggleCollapse:function(){if(b.hasClass(this.fieldset,"inputEx-Expanded")){b.replaceClass(this.fieldset,"inputEx-Expanded","inputEx-Collapsed")}else{b.replaceClass(this.fieldset,"inputEx-Collapsed","inputEx-Expanded")}},validate:function(){var e=true;for(var f=0;f<this.inputs.length;f++){var d=this.inputs[f];if(!d.isDisabled()){d.setClassFromState();var g=d.getState();if(g==inputEx.stateRequired||g==inputEx.stateInvalid){e=false}}}return e},getFieldsStates:function(){var d,e,j,h,g={fields:{},validate:true};for(var f=0;f<this.inputs.length;f++){d=this.inputs[f];e=d.options.name;j=d.getState();h=d.getStateString(j);g.fields[e]={};g.fields[e].valid=true;g.fields[e].message=h;if(j==inputEx.stateRequired||j==inputEx.stateInvalid){g.fields[e].valid=false;g.validate=false}}return g},enable:function(){for(var d=0;d<this.inputs.length;d++){this.inputs[d].enable()}},disable:function(){for(var d=0;d<this.inputs.length;d++){this.inputs[d].disable()}},setValue:function(g,e){if(!g){return}for(var f=0;f<this.inputs.length;f++){var h=this.inputs[f];var d=h.options.name;if(d&&!c.isUndefined(g[d])){h.setValue(g[d],false)}else{h.clear(false)}}this.runFieldsInteractions();if(e!==false){this.fireUpdatedEvt()}},getValue:function(){var f={};for(var e=0;e<this.inputs.length;e++){var d=this.inputs[e].getValue();if(this.inputs[e].options.name){if(this.inputs[e].options.flatten&&c.isObject(d)){c.augmentObject(f,d)}else{f[this.inputs[e].options.name]=d}}}return f},close:function(){for(var d=0;d<this.inputs.length;d++){this.inputs[d].close()}},focus:function(){if(this.inputs.length>0){this.inputs[0].focus()}},getFieldByName:function(d){if(!this.inputsNames.hasOwnProperty(d)){return null}return this.inputsNames[d]},onChange:function(e,f){var g=f[0];var d=f[1];this.runInteractions(d,g);this.fireUpdatedEvt()},runAction:function(d,f){var e=this.getFieldByName(d.name);if(YAHOO.lang.isFunction(e[d.action])){e[d.action].call(e)}else{if(YAHOO.lang.isFunction(d.action)){d.action.call(e,f)}else{throw new Error("action "+d.action+" is not a valid action for field "+d.name)}}},runInteractions:function(e,l){var g=inputEx.indexOf(e,this.inputs);var k=this.options.fields[g];if(YAHOO.lang.isUndefined(k.interactions)){return}var m=k.interactions;for(var h=0;h<m.length;h++){var d=m[h];if(d.valueTrigger===l){for(var f=0;f<d.actions.length;f++){this.runAction(d.actions[f],l)}}}},runFieldsInteractions:function(){if(this.hasInteractions){for(var d=0;d<this.inputs.length;d++){this.runInteractions(this.inputs[d],this.inputs[d].getValue())}}},clear:function(d){for(var e=0;e<this.inputs.length;e++){this.inputs[e].clear(false)}if(d!==false){this.fireUpdatedEvt()}},setErrors:function(f){var e,d;if(YAHOO.lang.isArray(f)){for(e=0;e<f.length;e++){d=f[e][0];value=f[e][1];if(this.inputsNames[d]){if(this.inputsNames[d].options.showMsg){this.inputsNames[d].displayMessage(value);b.replaceClass(this.inputsNames[d].divEl,"inputEx-valid","inputEx-invalid")}}}}else{if(YAHOO.lang.isObject(f)){for(d in f){if(f.hasOwnProperty(d)){if(this.inputsNames[d]){if(this.inputsNames[d].options.showMsg){this.inputsNames[d].displayMessage(f[d]);b.replaceClass(this.inputsNames[d].divEl,"inputEx-valid","inputEx-invalid")}}}}}}},destroy:function(){var d,e,f;for(d=0,e=this.inputs.length;d<e;d++){f=this.inputs[d];f.destroy()}inputEx.Group.superclass.destroy.call(this)}});inputEx.registerType("group",inputEx.Group,[{type:"string",label:"Name",name:"name",value:""},{type:"string",label:"Legend",name:"legend"},{type:"boolean",label:"Collapsible",name:"collapsible",value:false},{type:"boolean",label:"Collapsed",name:"collapsed",value:false},{type:"list",label:"Fields",name:"fields",elementType:{type:"type"}}],true)})();(function(){var a=YAHOO.lang;inputEx.visus={trimpath:function(d,e){if(!TrimPath){alert("TrimPath is not on the page. Please load inputex/lib/trimpath-template.js");return null}var c=TrimPath.parseTemplate(d.template);var b=c.process(e);return b},func:function(b,c){return b.func(c)},dump:function(b,c){return a.dump(c)}};inputEx.renderVisu=function(i,d,e){var b=i||{};var j=b.visuType||"dump";if(!inputEx.visus.hasOwnProperty(j)){throw new Error("inputEx: no visu for visuType: "+j)}var g=inputEx.visus[j];if(!a.isFunction(g)){throw new Error("inputEx: no visu for visuType: "+j)}var k=null;try{k=g(b,d)}catch(h){throw new Error("inputEx: error while running visu "+j+" : "+h.message)}var c=null;if(e){if(a.isString(e)){c=YAHOO.util.Dom.get(e)}else{c=e}}if(c){if(YAHOO.lang.isObject(k)&&k.tagName){c.innerHTML="";c.appendChild(k)}else{c.innerHTML=k}}return k}})();(function(){var b=YAHOO.util,d=YAHOO.lang,a=b.Event,c=b.Dom;inputEx.widget.Button=function(e){this.setOptions(e||{});if(!!this.options.parentEl){this.render(this.options.parentEl)}};d.augmentObject(inputEx.widget.Button.prototype,{setOptions:function(e){this.options={};this.options.id=d.isString(e.id)?e.id:c.generateId();this.options.className=e.className||"inputEx-Button";this.options.parentEl=d.isString(e.parentEl)?c.get(e.parentEl):e.parentEl;this.options.type=(e.type==="link"||e.type==="submit-link")?e.type:"submit";this.options.value=e.value;this.options.disabled=!!e.disabled;if(d.isFunction(e.onClick)){this.options.onClick={fn:e.onClick,scope:this}}else{if(d.isObject(e.onClick)){this.options.onClick={fn:e.onClick.fn,scope:e.onClick.scope||this}}}},render:function(f){var e;if(this.options.type==="link"||this.options.type==="submit-link"){this.el=inputEx.cn("a",{className:this.options.className,id:this.options.id,href:"#"});c.addClass(this.el,this.options.type==="link"?"inputEx-Button-Link":"inputEx-Button-Submit-Link");e=inputEx.cn("span",null,null,this.options.value);this.el.appendChild(e)}else{this.el=inputEx.cn("input",{type:"submit",value:this.options.value,className:this.options.className,id:this.options.id});c.addClass(this.el,"inputEx-Button-Submit")}f.appendChild(this.el);if(this.options.disabled){this.disable()}this.initEvents();return this.el},initEvents:function(){this.clickEvent=new b.CustomEvent("click");this.submitEvent=new b.CustomEvent("submit");a.addListener(this.el,"click",function(g){var f;a.stopEvent(g);if(this.disabled){f=false}else{f=this.clickEvent.fire()}if(this.options.type==="link"){f=false}if(f){this.submitEvent.fire()}},this,true);if(this.options.onClick){this.clickEvent.subscribe(this.options.onClick.fn,this.options.onClick.scope,true)}},disable:function(){this.disabled=true;c.addClass(this.el,"inputEx-Button-disabled");if(this.options.type==="submit"){this.el.disabled=true}},enable:function(){this.disabled=false;c.removeClass(this.el,"inputEx-Button-disabled");if(this.options.type==="submit"){this.el.disabled=false}},destroy:function(){this.clickEvent.unsubscribeAll();this.submitEvent.unsubscribeAll();b.Event.purgeElement(this.el,true);if(c.inDocument(this.el)){this.el.parentNode.removeChild(this.el)}}})})();(function(){var c=YAHOO.lang,a=YAHOO.util.Event,b=YAHOO.util.Dom;inputEx.StringField=function(d){inputEx.StringField.superclass.constructor.call(this,d);if(this.options.typeInvite){this.updateTypeInvite()}};c.extend(inputEx.StringField,inputEx.Field,{setOptions:function(d){inputEx.StringField.superclass.setOptions.call(this,d);this.options.regexp=d.regexp;this.options.size=d.size;this.options.maxLength=d.maxLength;this.options.minLength=d.minLength;this.options.typeInvite=d.typeInvite;this.options.readonly=d.readonly;this.options.autocomplete=c.isUndefined(d.autocomplete)?inputEx.browserAutocomplete:(d.autocomplete===false||d.autocomplete==="off")?false:true;this.options.trim=(d.trim===true)?true:false},renderComponent:function(){this.wrapEl=inputEx.cn("div",{className:"inputEx-StringField-wrapper"});var d={};d.type="text";d.id=this.divEl.id?this.divEl.id+"-field":YAHOO.util.Dom.generateId();if(this.options.size){d.size=this.options.size}if(this.options.name){d.name=this.options.name}if(this.options.readonly){d.readonly="readonly"}if(this.options.maxLength){d.maxLength=this.options.maxLength}d.autocomplete=this.options.autocomplete?"on":"off";this.el=inputEx.cn("input",d);this.wrapEl.appendChild(this.el);this.fieldContainer.appendChild(this.wrapEl)},setFieldName:function(d){this.el.name=d},initEvents:function(){a.addListener(this.el,"change",this.onChange,this,true);if(YAHOO.env.ua.ie){var d=this.el;new YAHOO.util.KeyListener(this.el,{keys:[13]},{fn:function(){d.blur();d.focus()}}).enable()}a.addFocusListener(this.el,this.onFocus,this,true);a.addBlurListener(this.el,this.onBlur,this,true);a.addListener(this.el,"keypress",this.onKeyPress,this,true);a.addListener(this.el,"keyup",this.onKeyUp,this,true)},getValue:function(){var d;d=(this.options.typeInvite&&this.el.value==this.options.typeInvite)?"":this.el.value;if(this.options.trim){d=YAHOO.lang.trim(d)}return d},setValue:function(e,d){this.el.value=(c.isNull(e)||c.isUndefined(e))?"":e;inputEx.StringField.superclass.setValue.call(this,e,d)},validate:function(){var e=this.getValue();if(e===""){return !this.options.required}var d=true;if(this.options.regexp){d=d&&e.match(this.options.regexp)}if(this.options.minLength){d=d&&e.length>=this.options.minLength}return d},disable:function(){this.el.disabled=true},enable:function(){this.el.disabled=false},isDisabled:function(){return this.el.disabled},focus:function(){if(!!this.el&&!c.isUndefined(this.el.focus)){this.el.focus()}},getStateString:function(d){if(d==inputEx.stateInvalid&&this.options.minLength&&this.el.value.length<this.options.minLength){return inputEx.messages.stringTooShort[0]+this.options.minLength+inputEx.messages.stringTooShort[1]}return inputEx.StringField.superclass.getStateString.call(this,d)},setClassFromState:function(){inputEx.StringField.superclass.setClassFromState.call(this);if(this.options.typeInvite){this.updateTypeInvite()}},updateTypeInvite:function(){if(!b.hasClass(this.divEl,"inputEx-focused")){if(this.isEmpty()){b.addClass(this.divEl,"inputEx-typeInvite");this.el.value=this.options.typeInvite}else{b.removeClass(this.divEl,"inputEx-typeInvite")}}else{if(b.hasClass(this.divEl,"inputEx-typeInvite")){this.el.value="";this.previousState=null;b.removeClass(this.divEl,"inputEx-typeInvite")}}},onFocus:function(d){inputEx.StringField.superclass.onFocus.call(this,d);if(this.options.typeInvite){this.updateTypeInvite()}},onKeyPress:function(d){},onKeyUp:function(d){}});inputEx.messages.stringTooShort=["This field should contain at least "," numbers or characters"];inputEx.registerType("string",inputEx.StringField,[{type:"string",label:"Type invite",name:"typeInvite",value:""},{type:"integer",label:"Size",name:"size",value:20},{type:"integer",label:"Min. length",name:"minLength",value:0}])})();(function(){var a=YAHOO.lang;inputEx.mixin.choice={addChoice:function(d){var c,b,e;if(!a.isObject(d)){d={value:d}}c={value:d.value,label:a.isString(d.label)?d.label:""+d.value,visible:true};c.node=this.createChoiceNode(c);b=this.getChoicePosition({position:d.position,label:d.before||d.after});if(b===-1){b=this.choicesList.length}else{if(a.isString(d.after)){b+=1}}this.choicesList.splice(b,0,c);this.appendChoiceNode(c.node,b);if(!!d.selected){e=this;setTimeout(function(){e.setValue(c.value)},0)}return c},removeChoice:function(d){var b,c;b=this.getChoicePosition(d);if(b===-1){throw new Error("SelectField : invalid or missing position, label or value in removeChoice")}c=this.choicesList[b];if(this.getValue()===c.value){this.clear()}this.choicesList.splice(b,1);this.removeChoiceNode(c.node)},hideChoice:function(e,d){var b,c;b=this.getChoicePosition(e);if(b!==-1){c=this.choicesList[b];if(c.visible){c.visible=false;if(this.getValue()===c.value){this.clear(d)}this.removeChoiceNode(c.node)}}},showChoice:function(d){var b,c;b=this.getChoicePosition(d);if(b!==-1){c=this.choicesList[b];if(!c.visible){c.visible=true;this.appendChoiceNode(c.node,b)}}},disableChoice:function(e,d){var b,c;if(a.isUndefined(d)||!a.isBoolean(d)){d=true}b=this.getChoicePosition(e);if(b!==-1){c=this.choicesList[b];this.disableChoiceNode(c.node);if(d&&this.getValue()===c.value){this.clear()}}},enableChoice:function(d){var b,c;b=this.getChoicePosition(d);if(b!==-1){c=this.choicesList[b];this.enableChoiceNode(c.node)}},getChoicePosition:function(c){var d,b=-1;d=this.choicesList.length;if(a.isNumber(c.position)&&c.position>=0&&c.position<d){b=parseInt(c.position,10)}else{if(!a.isUndefined(c.value)){b=inputEx.indexOf(c.value,this.choicesList,function(f,e){return e.value===f})}else{if(a.isString(c.label)){b=inputEx.indexOf(c.label,this.choicesList,function(e,f){return f.label===e})}}}return b}}}());(function(){var a=YAHOO.util.Event,b=YAHOO.lang;inputEx.SelectField=function(c){inputEx.SelectField.superclass.constructor.call(this,c)};b.extend(inputEx.SelectField,inputEx.Field,{setOptions:function(c){var d,e;inputEx.SelectField.superclass.setOptions.call(this,c);this.options.choices=b.isArray(c.choices)?c.choices:[];if(b.isArray(c.selectValues)){for(d=0,e=c.selectValues.length;d<e;d+=1){this.options.choices.push({value:c.selectValues[d],label:""+((c.selectOptions&&!b.isUndefined(c.selectOptions[d]))?c.selectOptions[d]:c.selectValues[d])})}}},renderComponent:function(){var c,d;this.el=inputEx.cn("select",{id:this.divEl.id?this.divEl.id+"-field":YAHOO.util.Dom.generateId(),name:this.options.name||""});this.choicesList=[];for(c=0,d=this.options.choices.length;c<d;c+=1){this.addChoice(this.options.choices[c])}this.fieldContainer.appendChild(this.el)},initEvents:function(){a.addListener(this.el,"change",this.onChange,this,true);a.addFocusListener(this.el,this.onFocus,this,true);a.addBlurListener(this.el,this.onBlur,this,true)},setValue:function(h,d){var e,g,c,f,j=false;for(e=0,g=this.choicesList.length;e<g;e+=1){if(this.choicesList[e].visible){c=this.choicesList[e];if(h===c.value){c.node.selected="selected";j=true;break}else{if(b.isUndefined(f)){f=e}}}}if(!j&&!b.isUndefined(f)){c=this.choicesList[f];c.node.selected="selected";h=c.value}inputEx.SelectField.superclass.setValue.call(this,h,d)},getValue:function(){var c;if(this.el.selectedIndex>=0){c=inputEx.indexOf(this.el.childNodes[this.el.selectedIndex],this.choicesList,function(e,d){return e===d.node});return this.choicesList[c].value}else{return""}},disable:function(){this.el.disabled=true},enable:function(){this.el.disabled=false},createChoiceNode:function(c){return inputEx.cn("option",{value:c.value},null,c.label)},removeChoiceNode:function(c){this.el.removeChild(c)},disableChoiceNode:function(c){c.disabled="disabled"},enableChoiceNode:function(c){c.removeAttribute("disabled")},appendChoiceNode:function(e,c){var f,d;f=0;for(d=0;d<c;d+=1){if(this.choicesList[d].visible){f+=1}}if(f<this.el.childNodes.length){YAHOO.util.Dom.insertBefore(e,this.el.childNodes[f])}else{this.el.appendChild(e)}}});b.augmentObject(inputEx.SelectField.prototype,inputEx.mixin.choice);inputEx.registerType("select",inputEx.SelectField,[{type:"list",name:"choices",label:"Choices",elementType:{type:"group",fields:[{label:"Value",name:"value",value:""},{label:"Label",name:"label"}]},value:[],required:true}])}());(function(){inputEx.EmailField=function(a){inputEx.EmailField.superclass.constructor.call(this,a)};YAHOO.lang.extend(inputEx.EmailField,inputEx.StringField,{setOptions:function(a){inputEx.EmailField.superclass.setOptions.call(this,a);this.options.messages.invalid=inputEx.messages.invalidEmail;this.options.regexp=inputEx.regexps.email;this.options.fixdomain=(YAHOO.lang.isUndefined(a.fixdomain)?false:!!a.fixdomain)},validateDomain:function(){var f,d,a,c,h,e,b,l;a=this.getValue();c=a.split("@")[1];h=[["gmail.com","gmail.com.br","_gmail.com","g-mail.com","g.mail.com","g_mail.com","gamail.com","gamil.com","gemail.com","ggmail.com","gimail.com","gmai.com","gmail.cim","gmail.co","gmaill.com","gmain.com","gmaio.com","gmal.com","gmali.com","gmeil.com","gmial.com","gmil.com","gtmail.com","igmail.com","gmail.fr"],["hotmail.co.uk","hotmail.com.uk"],["hotmail.com","hotmail.com.br","hotmail.br","0hotmail.com","8hotmail.com","_hotmail.com","ahotmail.com","ghotmail.com","gotmail.com","hatmail.com","hhotmail.com","ho0tmail.com","hogmail.com","hoimail.com","hoitmail.com","homail.com","homtail.com","hootmail.com","hopmail.com","hoptmail.com","hormail.com","hot.mail.com","hot_mail.com","hotail.com","hotamail.com","hotamil.com","hotemail.com","hotimail.com","hotlmail.com","hotmaail.com","hotmael.com","hotmai.com","hotmaial.com","hotmaiil.com","hotmail.acom","hotmail.bom","hotmail.ccom","hotmail.cm","hotmail.co","hotmail.coml","hotmail.comm","hotmail.con","hotmail.coom","hotmail.copm","hotmail.cpm","hotmail.lcom","hotmail.ocm","hotmail.om","hotmail.xom","hotmail2.com","hotmail_.com","hotmailc.com","hotmaill.com","hotmailo.com","hotmaio.com","hotmaiol.com","hotmais.com","hotmal.com","hotmall.com","hotmamil.com","hotmaol.com","hotmayl.com","hotmeil.com","hotmial.com","hotmil.com","hotmmail.com","hotmnail.com","hotmsil.com","hotnail.com","hotomail.com","hottmail.com","hotymail.com","hoymail.com","hptmail.com","htmail.com","htomail.com","ohotmail.com","otmail.com","rotmail.com","shotmail.com","hotmain.com"],["hotmail.fr","hotmail.ffr","hotmail.frr","hotmail.fr.br","hotmail.br","0hotmail.fr","8hotmail.fr","_hotmail.fr","ahotmail.fr","ghotmail.fr","gotmail.fr","hatmail.fr","hhotmail.fr","ho0tmail.fr","hogmail.fr","hoimail.fr","hoitmail.fr","homail.fr","homtail.fr","hootmail.fr","hopmail.fr","hoptmail.fr","hormail.fr","hot.mail.fr","hot_mail.fr","hotail.fr","hotamail.fr","hotamil.fr","hotemail.fr","hotimail.fr","hotlmail.fr","hotmaail.fr","hotmael.fr","hotmai.fr","hotmaial.fr","hotmaiil.fr","hotmail.frl","hotmail.frm","hotmail2.fr","hotmail_.fr","hotmailc.fr","hotmaill.fr","hotmailo.fr","hotmaio.fr","hotmaiol.fr","hotmais.fr","hotmal.fr","hotmall.fr","hotmamil.fr","hotmaol.fr","hotmayl.fr","hotmeil.fr","hotmial.fr","hotmil.fr","hotmmail.fr","hotmnail.fr","hotmsil.fr","hotnail.fr","hotomail.fr","hottmail.fr","hotymail.fr","hoymail.fr","hptmail.fr","htmail.fr","htomail.fr","ohotmail.fr","otmail.fr","rotmail.fr","shotmail.fr","hotmain.fr"],["yahoo.co.in","yaho.co.in","yahoo.co.cn","yahoo.co.n","yahoo.co.on","yahoo.coin","yahoo.com.in","yahoo.cos.in","yahoo.oc.in","yaoo.co.in","yhoo.co.in"],["yahoo.com.br","1yahoo.com.br","5yahoo.com.br","_yahoo.com.br","ayhoo.com.br","tahoo.com.br","uahoo.com.br","yagoo.com.br","yahho.com.br","yaho.com.br","yahoo.cm.br","yahoo.co.br","yahoo.com.ar","yahoo.com.b","yahoo.com.be","yahoo.com.ber","yahoo.com.bl","yahoo.com.brr","yahoo.com.brv","yahoo.com.bt","yahoo.com.nr","yahoo.coml.br","yahoo.con.br","yahoo.om.br","yahool.com.br","yahooo.com.br","yahoou.com.br","yaoo.com.br","yaroo.com.br","yhaoo.com.br","yhoo.com.br","yuhoo.com.br"],["yahoo.com","yahoomail.com","_yahoo.com","ahoo.com","ayhoo.com","eyahoo.com","hahoo.com","sahoo.com","yahho.com","yaho.com","yahol.com","yahoo.co","yahoo.con","yahoo.vom","yahoo0.com","yahoo1.com","yahool.com","yahooo.com","yahoou.com","yahoow.com","yahopo.com","yaloo.com","yaoo.com","yaroo.com","yayoo.com","yhaoo.com","yhoo.com","yohoo.com"],["yahoo.fr","yahoomail.fr","_yahoo.fr","ahoo.fr","ayhoo.fr","eyahoo.fr","hahoo.fr","sahoo.fr","yahho.fr","yaho.fr","yahol.fr","yahoo.co","yahoo.con","yahoo.vom","yahoo0.fr","yahoo1.fr","yahool.fr","yahooo.fr","yahoou.fr","yahoow.fr","yahopo.fr","yaloo.fr","yaoo.fr","yaroo.fr","yayoo.fr","yhaoo.fr","yhoo.fr","yohoo.fr"],["wanadoo.fr","wanadoo.frr","wanadoo.ffr","wanado.fr","wanadou.fr","wanadop.fr","wandoo.fr","wanaoo.fr","wannadoo.fr","wanadoo.com","wananadoo.fr","wanadoo.fe","wanaddo.fr","wanadoo.orange","waqnadoo.fr","wandaoo.fr","wannado.fr"],["msn.com","mns.com","msn.co"],["aol.com","aoel.com","aol.co"]];for(f=0,e=h.length;f<e;f++){b=h[f];for(d=0,l=b.length;d<l;d++){if(b.indexOf(c)===0){if(c===b[d]){return true}}else{if(c===b[d]){var k=YAHOO.util.Dom.generateId();var g=this;YAHOO.util.Event.addListener(k,"click",function(m){YAHOO.util.Event.stopEvent(m);var j=new RegExp(c,"i");var i=a.replace(j,b[0]);g.setValue(i)});this.options.messages.invalid=inputEx.messages.didYouMeant+"<a href='' id='"+k+"' style='color:blue;'>@"+b[0]+" ?</a>";return false}}}}return true},validate:function(){var a=inputEx.EmailField.superclass.validate.call(this);if(!!this.options.fixdomain){this.options.messages.invalid=inputEx.messages.invalidEmail;return a&&this.validateDomain()}else{return a}},getValue:function(){var a;a=inputEx.EmailField.superclass.getValue.call(this);return inputEx.removeAccents(a.toLowerCase())}});inputEx.messages.invalidEmail="Invalid email, ex: sample@test.com";inputEx.messages.didYouMeant="Did you mean : ";inputEx.registerType("email",inputEx.EmailField,[])})();(function(){var a=YAHOO.lang;inputEx.UrlField=function(b){inputEx.UrlField.superclass.constructor.call(this,b)};a.extend(inputEx.UrlField,inputEx.StringField,{setOptions:function(b){inputEx.UrlField.superclass.setOptions.call(this,b);this.options.className=b.className?b.className:"inputEx-Field inputEx-UrlField";this.options.messages.invalid=inputEx.messages.invalidUrl;this.options.favicon=a.isUndefined(b.favicon)?(("https:"==document.location.protocol)?false:true):b.favicon;this.options.size=b.size||50;this.options.regexp=inputEx.regexps.url},render:function(){inputEx.UrlField.superclass.render.call(this);this.el.size=this.options.size;if(!this.options.favicon){YAHOO.util.Dom.addClass(this.el,"nofavicon")}if(this.options.favicon){this.favicon=inputEx.cn("img",{src:inputEx.spacerUrl});this.fieldContainer.insertBefore(this.favicon,this.fieldContainer.childNodes[0]);YAHOO.util.Event.addListener(this.favicon,"click",function(){this.focus()},this,true)}},setClassFromState:function(){inputEx.UrlField.superclass.setClassFromState.call(this);if(this.options.favicon){this.updateFavicon((this.previousState==inputEx.stateValid)?this.getValue():null)}},updateFavicon:function(c){var b=c?c.match(/https?:\/\/[^\/]*/)+"/favicon.ico":inputEx.spacerUrl;if(b!=this.favicon.src){inputEx.sn(this.favicon,null,{visibility:"hidden"});this.favicon.src=b;if(this.timer){clearTimeout(this.timer)}var d=this;this.timer=setTimeout(function(){d.displayFavicon()},1000)}},displayFavicon:function(){inputEx.sn(this.favicon,null,{visibility:(this.favicon.naturalWidth!=0)?"visible":"hidden"})}});inputEx.messages.invalidUrl="Invalid URL, ex: http://www.test.com";inputEx.registerType("url",inputEx.UrlField,[{type:"boolean",label:"Display favicon",name:"favicon",value:true}])})();(function(){var c=YAHOO.lang,a=YAHOO.util.Event,b=YAHOO.util.Dom;inputEx.ListField=function(d){this.subFields=[];inputEx.ListField.superclass.constructor.call(this,d)};c.extend(inputEx.ListField,inputEx.Field,{arrowAnimColors:{from:"#eeee33",to:"#eeeeee"},setOptions:function(d){inputEx.ListField.superclass.setOptions.call(this,d);this.options.className=d.className?d.className:"inputEx-Field inputEx-ListField";this.options.sortable=c.isUndefined(d.sortable)?false:d.sortable;this.options.elementType=d.elementType||{type:"string"};this.options.useButtons=c.isUndefined(d.useButtons)?false:d.useButtons;this.options.unique=c.isUndefined(d.unique)?false:d.unique;this.options.listAddLabel=d.listAddLabel||inputEx.messages.listAddLink;this.options.listRemoveLabel=d.listRemoveLabel||inputEx.messages.listRemoveLink;this.options.maxItems=d.maxItems;this.options.minItems=d.minItems},renderComponent:function(){if(this.options.useButtons){this.addButton=inputEx.cn("img",{src:inputEx.spacerUrl,className:"inputEx-ListField-addButton"});this.fieldContainer.appendChild(this.addButton)}this.fieldContainer.appendChild(inputEx.cn("span",null,{marginLeft:"4px"},this.options.listLabel));this.childContainer=inputEx.cn("div",{className:"inputEx-ListField-childContainer"});this.fieldContainer.appendChild(this.childContainer);if(!this.options.useButtons){this.addButton=inputEx.cn("a",{className:"inputEx-List-link"},null,this.options.listAddLabel);this.fieldContainer.appendChild(this.addButton)}},initEvents:function(){a.addListener(this.addButton,"click",this.onAddButton,this,true)},validate:function(){var f=true;var k={};var d=this.subFields.length;if(c.isNumber(this.options.minItems)&&d<this.options.minItems){f=false}if(c.isNumber(this.options.maxItems)&&d>this.options.maxItems){f=false}for(var g=0;g<d&&f;g++){var e=this.subFields[g];e.setClassFromState();var h=e.getState();if(h==inputEx.stateRequired||h==inputEx.stateInvalid){f=false}if(this.options.unique){var j=c.dump(e.getValue());if(k[j]){f=false}else{k[j]=true}}}return f},setValue:function(g,d){if(!c.isArray(g)){throw new Error("inputEx.ListField.setValue expected an array, got "+(typeof g))}for(var f=0;f<g.length;f++){if(f==this.subFields.length){this.addElement(g[f])}else{this.subFields[f].setValue(g[f],false)}}var e=this.subFields.length-g.length;if(e>0){for(f=0;f<e;f++){this.removeElement(g.length)}}inputEx.ListField.superclass.setValue.call(this,g,d)},getValue:function(){var d=[];for(var e=0;e<this.subFields.length;e++){d[e]=this.subFields[e].getValue()}return d},addElement:function(e){var d=this.renderSubField(e);if(this.options.name){d.setFieldName(this.options.name+"["+this.subFields.length+"]")}this.subFields.push(d);return d},resetAllNames:function(){if(this.options.name){for(var e=0;e<this.subFields.length;e++){var d=this.subFields[e];d.setFieldName(this.options.name+"["+e+"]")}}},onAddButton:function(f){a.stopEvent(f);if(c.isNumber(this.options.maxItems)&&this.subFields.length>=this.options.maxItems){return}var d=this.addElement();d.focus();this.fireUpdatedEvt()},renderSubField:function(k){var g=inputEx.cn("div"),e;if(this.options.useButtons){e=inputEx.cn("img",{src:inputEx.spacerUrl,className:"inputEx-ListField-delButton"});a.addListener(e,"click",this.onDelete,this,true);g.appendChild(e)}var j=c.merge({},this.options.elementType);if(c.isObject(j.inputParams)&&!c.isUndefined(k)){j.inputParams.value=k}else{if(!c.isUndefined(k)){j.value=k}}var h=inputEx(j,this);var f=h.getEl();b.setStyle(f,"margin-left","4px");b.setStyle(f,"float","left");g.appendChild(f);h.updatedEvt.subscribe(this.onChange,this,true);if(this.options.sortable){var i=inputEx.cn("div",{className:"inputEx-ListField-Arrow inputEx-ListField-ArrowUp"});a.addListener(i,"click",this.onArrowUp,this,true);var d=inputEx.cn("div",{className:"inputEx-ListField-Arrow inputEx-ListField-ArrowDown"});a.addListener(d,"click",this.onArrowDown,this,true);g.appendChild(i);g.appendChild(d)}if(!this.options.useButtons){e=inputEx.cn("a",{className:"inputEx-List-link"},null,this.options.listRemoveLabel);a.addListener(e,"click",this.onDelete,this,true);g.appendChild(e)}g.appendChild(inputEx.cn("div",null,{clear:"both"}));this.childContainer.appendChild(g);return h},onArrowUp:function(l){var h=a.getTarget(l).parentNode;var f=null;var g=-1;for(var j=1;j<h.parentNode.childNodes.length;j++){var d=h.parentNode.childNodes[j];if(d==h){f=h.parentNode.childNodes[j-1];g=j;break}}if(f){var m=this.childContainer.removeChild(h);var k=this.childContainer.insertBefore(m,f);var n=this.subFields[g];this.subFields[g]=this.subFields[g-1];this.subFields[g-1]=n;this.resetAllNames();if(this.arrowAnim){this.arrowAnim.stop(true)}this.arrowAnim=new YAHOO.util.ColorAnim(k,{backgroundColor:this.arrowAnimColors},0.4);this.arrowAnim.onComplete.subscribe(function(){b.setStyle(k,"background-color","")});this.arrowAnim.animate();this.fireUpdatedEvt()}},onArrowDown:function(l){var g=a.getTarget(l).parentNode;var f=-1;var k=null;for(var h=0;h<g.parentNode.childNodes.length;h++){var d=g.parentNode.childNodes[h];if(d==g){k=g.parentNode.childNodes[h+1];f=h;break}}if(k){var m=this.childContainer.removeChild(g);var j=b.insertAfter(m,k);var n=this.subFields[f];this.subFields[f]=this.subFields[f+1];this.subFields[f+1]=n;this.resetAllNames();if(this.arrowAnim){this.arrowAnim.stop(true)}this.arrowAnim=new YAHOO.util.ColorAnim(j,{backgroundColor:this.arrowAnimColors},1);this.arrowAnim.onComplete.subscribe(function(){b.setStyle(j,"background-color","")});this.arrowAnim.animate();this.fireUpdatedEvt()}},onDelete:function(j){a.stopEvent(j);if(c.isNumber(this.options.minItems)&&this.subFields.length<=this.options.minItems){return}var f=a.getTarget(j).parentNode;var d=-1;var h=f.childNodes[this.options.useButtons?1:0];for(var g=0;g<this.subFields.length;g++){if(this.subFields[g].getEl()==h){d=g;break}}if(d!=-1){this.removeElement(d)}this.resetAllNames();this.fireUpdatedEvt()},removeElement:function(e){var d=this.subFields[e].getEl().parentNode;this.subFields[e]=undefined;this.subFields=inputEx.compactArray(this.subFields);d.parentNode.removeChild(d)}});inputEx.registerType("list",inputEx.ListField,[{type:"string",label:"List label",name:"listLabel",value:""},{type:"type",label:"List element type",required:true,name:"elementType"}]);inputEx.messages.listAddLink="Add";inputEx.messages.listRemoveLink="remove"})();(function(){var c=YAHOO.lang,a=YAHOO.util.Event,b=YAHOO.util.Dom;inputEx.CheckBox=function(d){inputEx.CheckBox.superclass.constructor.call(this,d)};c.extend(inputEx.CheckBox,inputEx.Field,{setOptions:function(d){inputEx.CheckBox.superclass.setOptions.call(this,d);this.options.className=d.className?d.className:"inputEx-Field inputEx-CheckBox";this.options.rightLabel=d.rightLabel||"";this.sentValues=d.sentValues||[true,false];this.options.sentValues=this.sentValues;this.checkedValue=this.sentValues[0];this.uncheckedValue=this.sentValues[1]},renderComponent:function(){var d=this.divEl.id?this.divEl.id+"-field":YAHOO.util.Dom.generateId();this.el=inputEx.cn("input",{id:d,type:"checkbox"});this.fieldContainer.appendChild(this.el);this.rightLabelEl=inputEx.cn("label",{"for":d,className:"inputEx-CheckBox-rightLabel"},null,this.options.rightLabel);this.fieldContainer.appendChild(this.rightLabelEl);this.hiddenEl=inputEx.cn("input",{type:"hidden",name:this.options.name||"",value:this.uncheckedValue});this.fieldContainer.appendChild(this.hiddenEl)},initEvents:function(){if(YAHOO.env.ua.ie){a.addListener(this.el,"click",function(d){YAHOO.lang.later(10,this,function(){this.onChange(d)})},this,true)}else{a.addListener(this.el,"change",this.onChange,this,true)}a.addFocusListener(this.el,this.onFocus,this,true);a.addBlurListener(this.el,this.onBlur,this,true)},onChange:function(d){this.hiddenEl.value=this.el.checked?this.checkedValue:this.uncheckedValue;inputEx.CheckBox.superclass.onChange.call(this,d)},getValue:function(){return this.el.checked?this.checkedValue:this.uncheckedValue},setValue:function(e,d){if(e===this.checkedValue||(typeof(e)=="string"&&typeof(this.checkedValue)=="boolean"&&e===String(this.checkedValue))){this.hiddenEl.value=this.checkedValue;this.el.checked=true;if(YAHOO.env.ua.ie===6){this.el.setAttribute("defaultChecked","checked")}}else{this.hiddenEl.value=this.uncheckedValue;this.el.checked=false;if(YAHOO.env.ua.ie===6){this.el.removeAttribute("defaultChecked")}}inputEx.CheckBox.superclass.setValue.call(this,e,d)},disable:function(){this.el.disabled=true},enable:function(){this.el.disabled=false}});inputEx.registerType("boolean",inputEx.CheckBox,[{type:"string",label:"Right Label",name:"rightLabel"}])})();(function(){var a=YAHOO.util.Event;inputEx.Textarea=function(b){inputEx.Textarea.superclass.constructor.call(this,b)};YAHOO.lang.extend(inputEx.Textarea,inputEx.StringField,{setOptions:function(b){inputEx.Textarea.superclass.setOptions.call(this,b);this.options.rows=b.rows||6;this.options.cols=b.cols||23;this.options.readonly=!!b.readonly},renderComponent:function(){this.wrapEl=inputEx.cn("div",{className:"inputEx-StringField-wrapper"});var b={};b.id=this.divEl.id?this.divEl.id+"-field":YAHOO.util.Dom.generateId();b.rows=this.options.rows;b.cols=this.options.cols;if(this.options.name){b.name=this.options.name}if(this.options.readonly){b.readonly="readonly"}this.el=inputEx.cn("textarea",b,null,this.options.value);this.wrapEl.appendChild(this.el);this.fieldContainer.appendChild(this.wrapEl)},validate:function(){var b=inputEx.Textarea.superclass.validate.call(this);if(this.options.maxLength){b=b&&this.getValue().length<=this.options.maxLength}return b},getStateString:function(b){if(b==inputEx.stateInvalid&&this.options.minLength&&this.el.value.length<this.options.minLength){return inputEx.messages.stringTooShort[0]+this.options.minLength+inputEx.messages.stringTooShort[1]}else{if(b==inputEx.stateInvalid&&this.options.maxLength&&this.el.value.length>this.options.maxLength){return inputEx.messages.stringTooLong[0]+this.options.maxLength+inputEx.messages.stringTooLong[1]}}return inputEx.Textarea.superclass.getStateString.call(this,b)},insert:function(e){var d,c,b;if(document.selection){this.el.focus();d=document.selection.createRange();d.text=e}else{if(this.el.selectionStart||this.el.selectionStart=="0"){c=this.el.selectionStart;b=this.el.selectionEnd;this.el.value=this.el.value.substring(0,c)+e+this.el.value.substring(b,this.el.value.length)}else{this.el.value+=e}}}});inputEx.messages.stringTooLong=["This field should contain at most "," numbers or characters"];inputEx.registerType("text",inputEx.Textarea,[{type:"integer",label:"Rows",name:"rows",value:6},{type:"integer",label:"Cols",name:"cols",value:23}])})();(function(){var d=YAHOO.lang,a=YAHOO.util.Event,b=YAHOO.util.Dom,c="inputEx-InPlaceEdit-";inputEx.InPlaceEdit=function(e){inputEx.InPlaceEdit.superclass.constructor.call(this,e)};d.extend(inputEx.InPlaceEdit,inputEx.Field,{setOptions:function(e){inputEx.InPlaceEdit.superclass.setOptions.call(this,e);this.options.visu=e.visu;this.options.editorField=e.editorField;this.options.buttonTypes=e.buttonTypes||{ok:"submit",cancel:"link"};this.options.animColors=e.animColors||null},renderComponent:function(){this.renderVisuDiv();this.renderEditor()},renderEditor:function(){this.editorContainer=inputEx.cn("div",{className:c+"editor"},{display:"none"});this.editorField=inputEx(this.options.editorField,this);var e=this.editorField.getEl();this.editorContainer.appendChild(e);b.addClass(e,c+"editorDiv");this.okButton=new inputEx.widget.Button({type:this.options.buttonTypes.ok,parentEl:this.editorContainer,value:inputEx.messages.okEditor,className:"inputEx-Button "+c+"OkButton",onClick:{fn:this.onOkEditor,scope:this}});this.cancelLink=new inputEx.widget.Button({type:this.options.buttonTypes.cancel,parentEl:this.editorContainer,value:inputEx.messages.cancelEditor,className:"inputEx-Button "+c+"CancelLink",onClick:{fn:this.onCancelEditor,scope:this}});this.editorContainer.appendChild(inputEx.cn("div",null,{clear:"both"}));this.fieldContainer.appendChild(this.editorContainer)},onVisuMouseOver:function(f){if(this.colorAnim){this.colorAnim.stop(true)}inputEx.sn(this.formattedContainer,null,{backgroundColor:this.options.animColors.from})},onVisuMouseOut:function(f){if(this.colorAnim){this.colorAnim.stop(true)}this.colorAnim=new YAHOO.util.ColorAnim(this.formattedContainer,{backgroundColor:this.options.animColors},1);this.colorAnim.onComplete.subscribe(function(){b.setStyle(this.formattedContainer,"background-color","")},this,true);this.colorAnim.animate()},renderVisuDiv:function(){this.formattedContainer=inputEx.cn("div",{className:"inputEx-InPlaceEdit-visu"});if(d.isFunction(this.options.formatDom)){this.formattedContainer.appendChild(this.options.formatDom(this.options.value))}else{if(d.isFunction(this.options.formatValue)){this.formattedContainer.innerHTML=this.options.formatValue(this.options.value)}else{this.formattedContainer.innerHTML=d.isUndefined(this.options.value)?inputEx.messages.emptyInPlaceEdit:this.options.value}}this.fieldContainer.appendChild(this.formattedContainer)},initEvents:function(){a.addListener(this.formattedContainer,"click",this.openEditor,this,true);if(this.options.animColors){a.addListener(this.formattedContainer,"mouseover",this.onVisuMouseOver,this,true);a.addListener(this.formattedContainer,"mouseout",this.onVisuMouseOut,this,true)}if(this.editorField.el){a.addListener(this.editorField.el,"keyup",this.onKeyUp,this,true);a.addListener(this.editorField.el,"keydown",this.onKeyDown,this,true)}},onKeyUp:function(f){if(f.keyCode==13){this.onOkEditor(f)}if(f.keyCode==27){this.onCancelEditor(f)}},onKeyDown:function(f){if(f.keyCode==9){this.onOkEditor(f)}},onOkEditor:function(h){a.stopEvent(h);var g=this.editorField.getValue();this.setValue(g);this.editorContainer.style.display="none";this.formattedContainer.style.display="";var f=this;setTimeout(function(){f.updatedEvt.fire(g)},50)},onCancelEditor:function(f){a.stopEvent(f);this.editorContainer.style.display="none";this.formattedContainer.style.display=""},openEditor:function(){var e=this.getValue();this.editorContainer.style.display="";this.formattedContainer.style.display="none";if(!d.isUndefined(e)){this.editorField.setValue(e)}this.editorField.focus();if(this.editorField.el&&d.isFunction(this.editorField.el.setSelectionRange)&&(!!e&&!!e.length)){this.editorField.el.setSelectionRange(0,e.length)}},getValue:function(){var e=(this.editorContainer.style.display=="");return e?this.editorField.getValue():this.value},setValue:function(f,e){this.value=f;if(d.isUndefined(f)||f==""){inputEx.renderVisu(this.options.visu,inputEx.messages.emptyInPlaceEdit,this.formattedContainer)}else{inputEx.renderVisu(this.options.visu,this.value,this.formattedContainer)}if(this.editorContainer.style.display==""){this.editorField.setValue(f)}inputEx.InPlaceEdit.superclass.setValue.call(this,f,e)},close:function(){this.editorContainer.style.display="none";this.formattedContainer.style.display=""}});inputEx.messages.emptyInPlaceEdit="(click to edit)";inputEx.messages.cancelEditor="cancel";inputEx.messages.okEditor="Ok";inputEx.registerType("inplaceedit",inputEx.InPlaceEdit,[{type:"type",label:"Editor",name:"editorField"}])})();(function(){var a=YAHOO.util.Event,b=YAHOO.util.Dom,c=YAHOO.lang;inputEx.TypeField=function(d){inputEx.TypeField.superclass.constructor.call(this,d)};c.extend(inputEx.TypeField,inputEx.Field,{renderComponent:function(){this.fieldValueWrapper=inputEx.cn("div",{className:"inputEx-TypeField-FieldValueWrapper"});this.fieldContainer.appendChild(this.fieldValueWrapper);this.propertyPanel=inputEx.cn("div",{className:"inputEx-TypeField-PropertiesPanel"},{display:"none"});var d=[];for(var e in inputEx.typeClasses){if(inputEx.typeClasses.hasOwnProperty(e)){d.push({value:e})}}this.typeSelect=new inputEx.SelectField({label:"Type",choices:d,parentEl:this.propertyPanel});this.groupOptionsWrapper=inputEx.cn("div");this.propertyPanel.appendChild(this.groupOptionsWrapper);this.button=inputEx.cn("div",{className:"inputEx-TypeField-EditButton"});this.button.appendChild(this.propertyPanel);this.fieldContainer.appendChild(this.button);this.rebuildGroupOptions()},initEvents:function(){inputEx.TypeField.superclass.initEvents.call(this);a.addListener(this.button,"click",this.onTogglePropertiesPanel,this,true);a.addListener(this.propertyPanel,"click",function(d){a.stopPropagation(d)},this,true);this.typeSelect.updatedEvt.subscribe(this.rebuildGroupOptions,this,true)},rebuildGroupOptions:function(){try{var d=null;if(this.group){d=this.group.getValue();this.group.close();this.group.destroy();this.groupOptionsWrapper.innerHTML=""}var g=inputEx.getFieldClass(this.typeSelect.getValue());var e={fields:g.groupOptions,parentEl:this.groupOptionsWrapper};this.group=new inputEx.Group(e);if(d){this.group.setValue({name:d.name,label:d.label})}this.group.updatedEvt.subscribe(this.onChangeGroupOptions,this,true);this.updateFieldValue()}catch(f){if(YAHOO.lang.isObject(window.console)&&YAHOO.lang.isFunction(window.console["log"])){console.log("inputEx.TypeField.rebuildGroupOptions: ",f)}}},onTogglePropertiesPanel:function(){if(this.propertyPanel.style.display=="none"){this.propertyPanel.style.display="";b.addClass(this.button,"opened")}else{this.propertyPanel.style.display="none";b.removeClass(this.button,"opened")}},onChangeGroupOptions:function(){this.updateFieldValue();this.fireUpdatedEvt()},updateFieldValue:function(){try{if(this.fieldValue){this.fieldValue.close();this.fieldValue.destroy();delete this.fieldValue;this.fieldValueWrapper.innerHTML=""}var e=this.group.getValue();e.type=this.getValue().type;e.parentEl=this.fieldValueWrapper;this.fieldValue=inputEx(e,this);this.fieldValue.updatedEvt.subscribe(this.fireUpdatedEvt,this,true)}catch(d){if(YAHOO.lang.isObject(window.console)&&YAHOO.lang.isFunction(window.console["log"])){console.log("Error while updateFieldValue",d.message)}}},setValue:function(f,d){this.typeSelect.setValue(f.type,false);this.rebuildGroupOptions();if(c.isObject(f.inputParams)){this.group.setValue(f.inputParams,false)}else{this.group.setValue(f,false)}this.updateFieldValue();var e=this;if(c.isObject(f.inputParams)&&!c.isUndefined(f.inputParams.value)){setTimeout(function(){e.fieldValue.setValue(f.inputParams.value,false)},50)}else{if(!c.isUndefined(f.value)){setTimeout(function(){e.fieldValue.setValue(f.value,false)},50)}}if(d!==false){this.fireUpdatedEvt(false)}},getValue:function(){var i=function(k,n){var j,l=k.groupOptions.length,m;for(j=0;j<l;j++){m=k.groupOptions[j];if(c.isObject(m.inputParams)&&m.inputParams.name==n){return m.inputParams.value}else{if(m.name==n){return m.value}}}return undefined};var e=this.group.getValue();var h=inputEx.getFieldClass(this.typeSelect.getValue());for(var g in e){if(e.hasOwnProperty(g)){var f=i(h,g);var d=e[g];if(f==d){e[g]=undefined}}}e.type=this.typeSelect.getValue();if(this.fieldValue){e.value=this.fieldValue.getValue()}return e}});inputEx.registerType("type",inputEx.TypeField,[])})();(function(){var c=YAHOO.util,g=YAHOO.lang;var b=c.Event,d=c.Dom,a=c.Connect,f=g.JSON,e=YAHOO.widget;WireIt.BaseEditor=function(h){this.el=d.get(h.parentEl);this.setOptions(h);this.render()};WireIt.BaseEditor.defaultOptions={layoutOptions:{units:[{position:"top",height:57,body:"top"},{position:"left",width:200,resize:true,body:"left",gutter:"5px",collapse:true,collapseSize:25,header:"Modules",scroll:true,animate:true},{position:"center",body:"center",gutter:"5px"},{position:"right",width:320,resize:true,body:"right",gutter:"5px",collapse:true,collapseSize:25,animate:true}]},propertiesFields:[{type:"string",name:"name",label:"Title",typeInvite:"Enter a title"},{type:"text",name:"description",label:"Description",cols:30,rows:4}],accordionViewParams:{collapsible:true,expandable:true,width:"auto",expandItem:0,animationSpeed:"0.3",animate:true,effect:YAHOO.util.Easing.easeBothStrong}};WireIt.BaseEditor.prototype={setOptions:function(h){this.options={};this.options.propertiesFields=h.propertiesFields||WireIt.BaseEditor.defaultOptions.propertiesFields;this.options.layoutOptions=h.layoutOptions||WireIt.BaseEditor.defaultOptions.layoutOptions;this.options.accordionViewParams=h.accordionViewParams||WireIt.BaseEditor.defaultOptions.accordionViewParams},render:function(){this.renderHelpPanel();this.layout=new e.Layout(this.el,this.options.layoutOptions);this.layout.render();this.renderPropertiesAccordion();this.renderButtons();this.renderSavedStatus();this.renderPropertiesForm()},renderHelpPanel:function(){this.helpPanel=new e.Panel("helpPanel",{fixedcenter:true,draggable:true,visible:false,modal:true});this.helpPanel.render()},renderAlertPanel:function(){this.alertPanel=new e.Panel("WiringEditor-alertPanel",{fixedcenter:true,draggable:true,width:"500px",visible:false,modal:true});this.alertPanel.setHeader("Message");this.alertPanel.setBody("<div id='alertPanelBody'></div><button id='alertPanelButton'>Ok</button>");this.alertPanel.render(document.body);b.addListener("alertPanelButton","click",function(){this.alertPanel.hide()},this,true)},renderButtons:function(){var i=d.get("toolbar");var h=new e.Button({label:"New",id:"WiringEditor-newButton",container:i});h.on("click",this.onNew,this,true);var k=new e.Button({label:"Load",id:"WiringEditor-loadButton",container:i});k.on("click",this.load,this,true);var j=new e.Button({label:"Save",id:"WiringEditor-saveButton",container:i});j.on("click",this.onSave,this,true);var m=new e.Button({label:"Delete",id:"WiringEditor-deleteButton",container:i});m.on("click",this.onDelete,this,true);var l=new e.Button({label:"Help",id:"WiringEditor-helpButton",container:i});l.on("click",this.onHelp,this,true)},renderSavedStatus:function(){this.savedStatusEl=WireIt.cn("div",{className:"savedStatus",title:"Not saved"},{display:"none"},"*");d.get("toolbar").appendChild(this.savedStatusEl)},onSave:function(){this.save()},save:function(){},alert:function(h){if(!this.alertPanel){this.renderAlertPanel()}d.get("alertPanelBody").innerHTML=h;this.alertPanel.show()},onHelp:function(){this.helpPanel.show()},renderPropertiesAccordion:function(){this.accordionView=new YAHOO.widget.AccordionView("accordionView",this.options.accordionViewParams)},renderPropertiesForm:function(){this.propertiesForm=new inputEx.Group({parentEl:YAHOO.util.Dom.get("propertiesForm"),fields:this.options.propertiesFields});this.propertiesForm.updatedEvt.subscribe(function(){this.markUnsaved()},this,true)},markSaved:function(){this.savedStatusEl.style.display="none"},markUnsaved:function(){this.savedStatusEl.style.display=""},isSaved:function(){return(this.savedStatusEl.style.display=="none")}}})();(function(){var a=YAHOO.util,c=YAHOO.lang,b=a.Dom;WireIt.ModuleProxy=function(e,d){this._WiringEditor=d;WireIt.ModuleProxy.superclass.constructor.call(this,e,"module",{dragElId:"moduleProxy"});this.isTarget=false};c.extend(WireIt.ModuleProxy,YAHOO.util.DDProxy,{startDrag:function(g){WireIt.ModuleProxy.superclass.startDrag.call(this,g);var d=this.getDragEl(),f=this.getEl();d.innerHTML=f.innerHTML;d.className=f.className},endDrag:function(d){},onDragDrop:function(i,g){var j=g[0],h=g[0]._layer,f=this.getDragEl(),k=b.getXY(f),d=b.getXY(h.el);this._WiringEditor.addModule(this._module,[k[0]-d[0]+h.el.scrollLeft,k[1]-d[1]+h.el.scrollTop])}})})();(function(){var c=YAHOO.util,f=YAHOO.lang;var b=c.Event,d=c.Dom,a=c.Connect,e=YAHOO.widget;WireIt.WiringEditor=function(g){this.modulesByName={};WireIt.WiringEditor.superclass.constructor.call(this,g);if(this.adapter.init&&YAHOO.lang.isFunction(this.adapter.init)){this.adapter.init()}this.load()};f.extend(WireIt.WiringEditor,WireIt.BaseEditor,{setOptions:function(k){WireIt.WiringEditor.superclass.setOptions.call(this,k);this.modules=k.modules||[];for(var l=0;l<this.modules.length;l++){var g=this.modules[l];this.modulesByName[g.name]=g}this.adapter=k.adapter||WireIt.WiringEditor.adapters.JsonRpc;this.options.languageName=k.languageName||"anonymousLanguage";this.options.layerOptions={};var n=k.layerOptions||{};this.options.layerOptions.parentEl=n.parentEl?n.parentEl:d.get("center");this.options.layerOptions.layerMap=YAHOO.lang.isUndefined(n.layerMap)?true:n.layerMap;this.options.layerOptions.layerMapOptions=n.layerMapOptions||{parentEl:"layerMap"};this.options.modulesAccordionViewParams=YAHOO.lang.merge({collapsible:true,expandable:true,width:"auto",expandItem:0,animationSpeed:"0.3",animate:true,effect:YAHOO.util.Easing.easeBothStrong},k.modulesAccordionViewParams||{});var h=this;var j=function(i){return(i=="Group")?({xtype:"WireIt.GroupFormContainer",title:"Group",collapsible:true,fields:[],legend:"Inner group fields",getBaseConfigFunction:j}):h.modulesByName[i].container};this.options.layerOptions.grouper={baseConfigFunction:j}},render:function(){WireIt.WiringEditor.superclass.render.call(this);this.layer=new WireIt.Layer(this.options.layerOptions);this.layer.eventChanged.subscribe(this.onLayerChanged,this,true);this.renderModulesAccordion();this.buildModulesList()},renderModulesAccordion:function(){if(!d.get("modulesAccordionView")){d.get("left").appendChild(WireIt.cn("ul",{id:"modulesAccordionView"}));var g=WireIt.cn("li");g.appendChild(WireIt.cn("h2",null,null,"Main"));var i=WireIt.cn("div");i.appendChild(WireIt.cn("div",{id:"module-category-main"}));g.appendChild(i);d.get("modulesAccordionView").appendChild(g)}this.modulesAccordionView=new YAHOO.widget.AccordionView("modulesAccordionView",this.options.modulesAccordionViewParams);for(var h=1,j=this.modulesAccordionView.getPanels().length;h<j;h++){this.modulesAccordionView.openPanel(h)}},buildModulesList:function(){var g=this.modules;for(var h=0;h<g.length;h++){this.addModuleToList(g[h])}if(!this.ddTarget){this.ddTarget=new YAHOO.util.DDTarget(this.layer.el,"module");this.ddTarget._layer=this.layer}},addModuleToList:function(h){try{var l=WireIt.cn("div",{className:"WiringEditor-module"});if(h.description){l.title=h.description}if(h.container.icon){l.appendChild(WireIt.cn("img",{src:h.container.icon}))}l.appendChild(WireIt.cn("span",null,null,h.name));var k=new WireIt.ModuleProxy(l,this);k._module=h;var j=h.category||"main";var i=d.get("module-category-"+j);if(!i){this.modulesAccordionView.addPanel({label:j,content:"<div id='module-category-"+j+"'></div>"});this.modulesAccordionView.openPanel(this.modulesAccordionView._panels.length-1);i=d.get("module-category-"+j)}i.appendChild(l)}catch(g){console.log(g)}},getCurrentGrouper:function(g){return g.currentGrouper},addModule:function(j,m){try{if(m[0]<0){m[0]=0}if(m[1]<0){m[1]=0}var l=j.container;l.position=m;l.title=j.name;var h=this;l.getGrouper=function(){return h.getCurrentGrouper(h)};var g=this.layer.addContainer(l);var k=j.category||"main";d.addClass(g.el,"WiringEditor-module-category-"+k.replace(/ /g,"-"));d.addClass(g.el,"WiringEditor-module-"+j.name.replace(/ /g,"-"))}catch(i){this.alert("Error Layer.addContainer: "+i.message);if(window.console&&YAHOO.lang.isFunction(console.log)){console.log(i)}}},save:function(){var g=this.getValue();if(g.name===""){this.alert("Please choose a name");return}this.tempSavedWiring={name:g.name,working:g.working,language:this.options.languageName};this.adapter.saveWiring(this.tempSavedWiring,{success:this.saveModuleSuccess,failure:this.saveModuleFailure,scope:this})},saveModuleSuccess:function(g){this.markSaved();this.alert("Saved !")},saveModuleFailure:function(g){this.alert("Unable to save the wiring : "+g)},onNew:function(){if(!this.isSaved()){if(!confirm("Warning: Your work is not saved yet ! Press ok to continue anyway.")){return}}this.preventLayerChangedEvent=true;this.layer.clear();this.propertiesForm.clear(false);this.markSaved();this.preventLayerChangedEvent=false},onDelete:function(){if(confirm("Are you sure you want to delete this wiring ?")){var g=this.getValue();this.adapter.deleteWiring({name:g.name,language:this.options.languageName},{success:function(h){this.onNew();this.alert("Deleted !")},failure:function(h){this.alert("Unable to delete wiring: "+h)},scope:this})}},renderLoadPanel:function(){if(!this.loadPanel){this.loadPanel=new e.Panel("WiringEditor-loadPanel",{fixedcenter:true,draggable:true,width:"500px",visible:false,modal:true});this.loadPanel.setHeader("Select the wiring to load");this.loadPanel.setBody("Filter: <input type='text' id='loadFilter' /><div id='loadPanelBody'></div>");this.loadPanel.render(document.body);b.onAvailable("loadFilter",function(){b.addListener("loadFilter","keyup",this.inputFilterTimer,this,true)},this,true)}},inputFilterTimer:function(){if(this.inputFilterTimeout){clearTimeout(this.inputFilterTimeout);this.inputFilterTimeout=null}var g=this;this.inputFilterTimeout=setTimeout(function(){g.updateLoadPanelList(d.get("loadFilter").value)},500)},updateLoadPanelList:function(j){this.renderLoadPanel();var l=WireIt.cn("ul");if(f.isArray(this.pipes)){for(var h=0;h<this.pipes.length;h++){var g=this.pipes[h];if(!j||j===""||g.name.match(new RegExp(j,"i"))){l.appendChild(WireIt.cn("li",null,{cursor:"pointer"},g.name))}}}var k=d.get("loadPanelBody");YAHOO.util.Event.purgeElement(k,true);k.innerHTML="";k.appendChild(l);b.addListener(l,"click",function(m,i){this.loadPipe(b.getTarget(m).innerHTML)},this,true)},load:function(){this.adapter.listWirings({language:this.options.languageName},{success:function(g){this.onLoadSuccess(g)},failure:function(g){this.alert("Unable to load the wirings: "+g)},scope:this})},onLoadSuccess:function(h){if(h&&h.length&&h.length>0){this.pipes=h;this.pipesByName={};for(var g=0;g<this.pipes.length;g++){this.pipesByName[this.pipes[g].name]=this.pipes[g]}this.updateLoadPanelList();if(!this.checkAutoLoad()){this.loadPanel.show()}}},checkAutoLoad:function(){if(!this.checkAutoLoadOnce){var j=window.location.search.substr(1).split("&");var k={};for(var h=0;h<j.length;h++){var g=j[h].split("=");k[g[0]]=window.decodeURIComponent(g[1])}this.checkAutoLoadOnce=true;if(k.autoload){this.loadPipe(k.autoload);return true}}return false},getPipeByName:function(h){var k=this.pipes.length,g;for(var j=0;j<k;j++){if(this.pipes[j].name==h){return this.pipes[j].working}}return null},loadPipe:function(j){if(!this.isSaved()){if(!confirm("Warning: Your work is not saved yet ! Press ok to continue anyway.")){return}}try{this.preventLayerChangedEvent=true;this.loadPanel.hide();var o=this.getPipeByName(j),l;if(!o){this.alert("The wiring '"+j+"' was not found.");return}this.layer.clear();this.propertiesForm.setValue(o.properties,false);if(f.isArray(o.modules)){for(l=0;l<o.modules.length;l++){var g=o.modules[l];if(this.modulesByName[g.name]){var n=this.modulesByName[g.name].container;YAHOO.lang.augmentObject(g.config,n);g.config.title=g.name;var h=this.layer.addContainer(g.config);d.addClass(h.el,"WiringEditor-module-"+g.name);h.setValue(g.value)}else{throw new Error("WiringEditor: module '"+g.name+"' not found !")}}if(f.isArray(o.wires)){for(l=0;l<o.wires.length;l++){this.layer.addWire(o.wires[l])}}}this.markSaved();this.preventLayerChangedEvent=false}catch(k){this.alert(k);if(window.console&&YAHOO.lang.isFunction(console.log)){console.log(k)}}},onLayerChanged:function(){if(!this.preventLayerChangedEvent){this.markUnsaved()}},getValue:function(){var h;var j={modules:[],wires:[],properties:null};for(h=0;h<this.layer.containers.length;h++){j.modules.push({name:this.layer.containers[h].title,value:this.layer.containers[h].getValue(),config:this.layer.containers[h].getConfig()})}for(h=0;h<this.layer.wires.length;h++){var k=this.layer.wires[h];var g=k.getConfig();g.src={moduleId:WireIt.indexOf(k.terminal1.container,this.layer.containers),terminal:k.terminal1.name};g.tgt={moduleId:WireIt.indexOf(k.terminal2.container,this.layer.containers),terminal:k.terminal2.name};j.wires.push(g)}j.properties=this.propertiesForm.getValue();return{name:j.properties.name,working:j}}});WireIt.WiringEditor.adapters={}})();(function(){var c=YAHOO.util,g=YAHOO.lang;var b=c.Event,d=c.Dom,a=c.Connect,f=g.JSON,e=YAHOO.widget;WireIt.Group=function(h,j,i){this.containers=[];this.groups=[];this.properties={};this.layer=j;this.grouper=h;this.events={};this.events.containerAdded=new YAHOO.util.CustomEvent("containerAdded");this.events.containerRemoved=new YAHOO.util.CustomEvent("containerRemoved");this.events.groupAdded=new YAHOO.util.CustomEvent("groupAdded");this.events.groupRemoved=new YAHOO.util.CustomEvent("groupRemoved");this.events.groupEmptied=new YAHOO.util.CustomEvent("groupEmptied");this.events.stateChanged=new YAHOO.util.CustomEvent("stateChanged");this.stateChangeFunc=function(k,l){this.events.stateChanged.fire({event:k,objects:l})};this.events.containerAdded.subscribe(this.stateChangeFunc,this,true);this.events.containerRemoved.subscribe(this.stateChangeFunc,this,true);this.events.groupAdded.subscribe(this.stateChangeFunc,this,true);this.events.groupRemoved.subscribe(this.stateChangeFunc,this,true);this.events.containerRemoved.subscribe(this.checkGroupEmpty,this,true);this.events.groupRemoved.subscribe(this.checkGroupEmpty,this,true);this.collapsing=false;j.eventRemoveContainer.subscribe(function(k,l){if(!this.collapsing){this.removeContainer.call(this,l[0])}},this,true)};WireIt.Group.prototype={collapse:function(n){if(g.isValue(this.groupContainer)){return this.groupContainer}for(var t in this.groups){var k=this.groups[t];k.group.collapse.call(k.group,true)}var h=WireIt.GroupUtils.getMap(this);var o=WireIt.GroupUtils.getCollapsedConfig(this,h);var i=[];WireIt.GroupUtils.addAllContainers(this,i);var s=WireIt.GroupUtils.serialiseGroup(this,i);var j=WireIt.GroupUtils.getInternalModuleConfig(i,o.center);var p=function(u){return i.indexOf(u)};var l=function(x,v,u){var y;if(x=="container"){y=h.containerMap}else{y=h.groupMap}var w=y[v].terminals[u];if(g.isObject(w)){return w.externalName}else{var z=y[v].fields[u];if(g.isObject(z)&&z.fieldConfig.wirable){return z.externalName}}};var r=WireIt.GroupUtils.getWireConfig(this,p,l);var q=this.layer.addContainer({xtype:"WireIt.GroupFormContainer",title:"Group",collapsible:false,fields:o.fields,terminals:o.terminals,legend:null,getBaseConfigFunction:this.grouper.baseConfigFunction,groupConfig:{group:s,center:o.center,modules:j,wires:r.internal,map:WireIt.GroupUtils.getExternalToInternalMap(h)},position:o.position});this.addExternalWires(q,r.external);this.collapsing=true;var m;for(m in this.containers){this.layer.removeContainer(this.containers[m].container)}for(m in this.groups){WireIt.GroupUtils.removeGroupFromLayer(this.groups[m].group,this.layer)}this.collapsing=false;q.group=this;this.containers=[];this.groups=[];this.groupContainer=q;this.properties.expanded=g.isValue(n)?n:false;return q},checkGroupEmpty:function(){if(!g.isValue(this.groupContainer)&&this.containers.length==0&&this.groups.length==0){this.events.groupEmptied.fire(this)}},expand:function(){if(g.isValue(this.groupContainer)){this.groupContainer.expand()}},addContainer:function(h,j){if(!g.isObject(j)){j={fields:{},terminals:{}}}var i={container:h,overrides:j};this.containers.push(i);h.group=this;h.eventAddWire.subscribe(this.stateChangeFunc,this,true);h.eventRemoveWire.subscribe(this.stateChangeFunc,this,true);this.events.containerAdded.fire(i)},addGroup:function(i,j){if(!g.isObject(j)){j={fields:{},terminals:{}}}var h={group:i,overrides:j};this.groups.push(h);i.group=this;i.events.stateChanged.subscribe(this.stateChangeFunc,this,true);i.events.groupEmptied.subscribe(function(){this.removeGroup(i)},this,true);this.events.containerAdded.fire(h)},removeContainer:function(h,i){if(!g.isValue(i)){i=WireIt.GroupUtils.firstTestSucess(this.containers,function(j){return j.container==h})}if(i!=-1){this.containers.splice(i,1);h.group=null;this.events.containerRemoved.fire(h)}},removeGroup:function(i,h){if(!g.isValue(h)){h=WireIt.GroupUtils.firstTestSucess(this.groups,function(j){return j.group==i})}if(h!=-1){i.group=null;this.events.groupRemoved.fire(this.groups.splice(h,1))}},unGroup:function(){if(g.isValue(this.groupContainer)){this.expand()}var i={};i.containers=[];g.augmentObject(i.containers,this.containers);i.groups=[];g.augmentObject(i.groups,this.groups);for(var j in i.containers){var l=i.containers[j];this.removeContainer(l.container);if(g.isValue(this.group)){this.group.addContainer(l.container,l.overrides)}}for(var h in i.groups){var k=i.groups[h];this.removeGroup(k.group);if(g.isValue(this.group)){this.group.addGroup(k.group,k.overrides)}}if(g.isValue(this.group)){this.group.removeGroup(this);this.group=null}else{this.layer.removeGroup(this)}this.events.stateChanged.fire(this)},generateUI:function(i,k){if(!g.isValue(i)){i=WireIt.GroupUtils.getMap(this)}listRows=[];var r={};var n={};var m=this.layer;var s=this;var p=function(K,I,w,J,G,u,z,B,x){var A=function(M){D=[];for(var L=0;L<4;L++){var N=WireIt.cn("td");D.push(N);M.appendChild(N)}return D};var y=WireIt.cn("tr");y.onmouseover=w;y.onmouseout=J;var C=[];var v=WireIt.cn("input",{type:"checkbox"});v.checked=(typeof G=="undefined")?"":G;v.disabled=z;C.push(v);var H=WireIt.cn("input",{type:"text"});H.value=(typeof u=="undefined")?"":u;C.push(H);var D=A(y);D[0].innerHTML=K;D[1].appendChild(v);D[2].appendChild(H);if(B){var t=WireIt.cn("select");t.appendChild(WireIt.cn("option",{value:"top"},{},"Top"));t.appendChild(WireIt.cn("option",{value:"bottom"},{},"Bottom"));t.appendChild(WireIt.cn("option",{value:"left"},{},"Left"));t.appendChild(WireIt.cn("option",{value:"right"},{},"Right"));if(g.isValue(x)){t.value=x}C.push(t);D[3].appendChild(t)}else{D[3].align="center";D[3].innerHTML="---"}listRows.push(y);for(var E in C){var F=C[E];F.onfocus=w;F.onblur=J;F.onchange=k}return{visible:v,externalName:H,side:t}};var j=function(w,D,u,t,x,E,B){var C=false;var z=false;var v=false;var A=x[w];if(!g.isValue(A)){var y=p(w,t,function(){E(t)},function(){B(t)},D.visible||u.visible,g.isValue(u.rename)?u.rename:"",g.isValue(D.forceVisible)?D.forceVisible:false,true,u.side);return y}};var h=function(v,w,u,t,x,C,A){var B=false;var z=false;if(w.fieldConfig.wirable){x[v]=true}var y=p(v,t,function(){C(t)},function(){A(t)},u.visible||w.visible,g.isValue(u.rename)?u.rename:"",g.isValue(w.forceVisible)?w.forceVisible:false);return y};var o=[];var l=[];var q=function(x,I,y,B,F){for(var v in x){var G=x[v];var E={};var D=v;var A={};var J={};for(var C in G.fields){var z=G.fields[C];var t=I[v].container.getValue();if(t[C]==undefined||(t[C]!=undefined&&t[C]!="[wired]")){A[C]=h(C,z,WireIt.GroupUtils.valueOr(I[v].overrides.fields[C],{}),v,E,B,F)}}for(var u in G.terminals){var H=G.terminals[u];var w=j(u,H,WireIt.GroupUtils.valueOr(I[v].overrides.terminals[u],{}),v,E,B,F);if(g.isValue(w)){J[u]=w}}y.push({fields:A,terminals:J})}};q(i.containerMap,this.containers,o,function(t){s.layer.setSuperHighlighted([s.containers[t].container])},function(t){s.layer.unsetSuperHighlighted()});q(i.groupMap,this.groups,l,function(t){var u=[];WireIt.GroupUtils.applyToContainers(s.groups[t].group,true,function(v){u.push(v)});s.layer.setSuperHighlighted(u)},function(t){s.layer.unsetSuperHighlighted()});return{listRows:listRows,containerUIMap:o,groupUIMap:l}},getAndCheckOverrides:function(n,j){var i={};g.augmentObject(i,this);i.containers=[];i.groups=[];var p=WireIt.GroupUtils.getOverridesFromUI(n,j);for(var m in this.containers){var o={};o.container=this.containers[m].container;o.overrides=p.containerOverrides[m];i.containers[m]=o}for(var q in this.groups){var l={};l.group=this.groups[q].group;l.overrides=p.groupOverrides[q];i.groups[q]=l}var h;try{h=WireIt.GroupUtils.getMap(i)}catch(k){if(g.isObject(k)&&g.isValue(k.type)&&k.type=="MappingError"){return{overrides:p,valid:false,error:k}}else{throw k}}return{overrides:p,valid:true}},setGroupOptions:function(k){for(var i in k.containerOverrides){var j=k.containerOverrides[i];this.containers[i].overrides=j}for(var h in k.groupOverrides){var j=k.groupOverrides[i];this.groups[h].overrides=j}},addExternalWires:function(m,i){var l=this.layer;for(var o in i){var h=i[o];var k={};k.moduleId=this.layer.containers.indexOf(m);k.terminal=h.externalName;var n={};n.moduleId=this.layer.containers.indexOf(h.externalTerminal.container);n.terminal=h.externalTerminal.options.name;var j={};if(h.groupIsSource){j.src=k;j.tgt=n}else{j.src=n;j.tgt=k}this.layer.addWire(j)}}}})();(function(){var b=YAHOO.util,d=YAHOO.lang;var a=b.Event,c=b.Dom;WireIt.Grouper=function(f,e){this.layer=f;this.baseConfigFunction=e;this.containers=[];this.groups=[];this.setupWidget(c.get("groupConfig"));f.eventRemoveContainer.subscribe(function(g,h){this.removeContainer(h[0])},this,true);f.eventAddContainer.subscribe(function(h,g){var i=this.display;g[0].eventFocus.subscribe(function(k,l){var j=l[0];if(d.isValue(j.group)){this.showGroup(j.group)}else{this.deselectGroup();this.hideGroupConfigure()}},this,true)},this,true);this.rubberband=new WireIt.RubberBand(this);this.rubberband.style={};this.rubberband.style.position="absolute"};WireIt.Grouper.prototype={setupWidget:function(i){this.display={};this.display.mainDiv=i;this.display.buttonsElement=WireIt.cn("div");i.appendChild(this.display.buttonsElement);var f=WireIt.cn("button",{},{},"Collapse");f.id="groupConfigCollapseButton";this.display.buttonsElement.appendChild(f);a.addListener("groupConfigCollapseButton","click",this.groupCollapse,this,true);var h=WireIt.cn("select");this.display.groupSelect=h;h.id="groupConfigGroupSelect";this.display.buttonsElement.appendChild(h);a.addListener("groupConfigGroupSelect","change",function(){this.selectGroup.call(this,h)},this,true);var g=WireIt.cn("button",{},{},"Ungroup");g.id="groupUngroupButton";this.display.buttonsElement.appendChild(g);a.addListener("groupUngroupButton","click",this.unGroup,this,true);var e=WireIt.cn("div");i.appendChild(e);var j=WireIt.cn("table",{id:"groupPanelBodyList"});this.display.list=j;e.appendChild(j);var k=WireIt.cn("tr");this.display.listHeadRow=k;j.appendChild(k);k.appendChild(WireIt.cn("th",{},{},"Name"));k.appendChild(WireIt.cn("th",{},{},"Visible"));k.appendChild(WireIt.cn("th",{},{},"New name"));k.appendChild(WireIt.cn("th",{},{},"Show"));this.hideGroupConfigure()},setDisplay:function(f){this.display.list.innerHTML="";this.display.list.appendChild(this.display.listHeadRow);for(var e in f){this.display.list.appendChild(f[e])}},groupCollapse:function(){if(d.isValue(this.selectedGroup)){this.selectedGroup.collapse()}},selectGroup:function(e){var f=e.selectedIndex;if(f>=0&&d.isArray(this.selectedGroups)&&f<this.selectedGroups.length){var g=this.selectedGroups[f];this.showGroupConfigure(g)}else{alert("index wrong ("+f+")")}},unGroup:function(){if(d.isValue(this.selectedGroup)){var e=this.selectedGroup;this.deselectGroup();e.unGroup()}},setGroupOptions:function(){var e=this.display.containerUIMap;var f=this.display.groupUIMap;var g=this.selectedGroup;var h=g.getAndCheckOverrides(e,f);if(h.valid){g.setGroupOptions(h.overrides)}else{alert("Validation error, "+h.error.message)}},addContainer:function(e){if(d.isValue(e.group)){var f=WireIt.GroupUtils.getOuterGroup(e.group);this.addGroup(f)}else{if(this.containers.indexOf(e)==-1){this.containers.push(e);e.addedToGroup()}}},removeContainer:function(e,f){if(!d.isValue(f)){f=this.containers.indexOf(e)}if(f!=-1){this.containers.splice(f,1);e.removedFromGroup()}},addGroup:function(f){if(this.groups.indexOf(f)==-1){this.groups.push(f);var e=function(h){WireIt.GroupUtils.applyToContainers(h,true,function(g){g.addedToGroup()})};e(f);f.events.groupEmptied.subscribe(function(){this.removeGroup(f)},this,true);f.events.containerAdded.subscribe(function(g,h){h[0].addedToGroup()},this,true);f.events.groupAdded.subscribe(function(h,g){e(g[0])},this,true);f.events.containerRemoved.subscribe(function(g,h){this.addContainer(h[0])},this,true);f.events.groupRemoved.subscribe(function(h,g){this.addGroup(g[0])},this,true)}},removeGroup:function(h,f){if(!d.isValue(f)){f=this.groups.indexOf(h)}if(f!=-1){this.groups.splice(f,1);var g=[];WireIt.GroupUtils.addAllContainers(h,g);for(var e in g){g[e].removedFromGroup()}}},toggle:function(e){if(d.isValue(e.group)){var h=WireIt.GroupUtils.getOuterGroup(e.group);var g=this.groups.indexOf(h);if(g==-1){this.addGroup(h)}else{this.removeGroup(h,g)}}else{var f=this.containers.indexOf(e);if(f==-1){this.addContainer(e)}else{this.removeContainer(e,f)}}},makeGroup:function(){if(this.containers.length>0||this.groups.length>0){var l=new WireIt.Group(this,this.layer);var m=[];var h=[];for(var f in this.containers){var k=this.containers[f];l.addContainer(k);h.push(k)}for(var n in this.groups){var i=this.groups[n];l.addGroup(i);this.layer.removeGroup(i);m.push(i)}for(var j in h){this.removeContainer(h[j])}for(var e in m){this.removeGroup(m[e])}this.layer.groups.push(l);l.events.groupEmptied.subscribe(function(){this.layer.removeGroup.call(this.layer,l)},this,true);this.showGroup(l,true)}},showGroup:function(f,h){var e;if(h){e=f}else{e=WireIt.GroupUtils.getOuterGroup(f)}this.showGroupConfigure.call(this,e);this.setupSelectedGroups(f)},setupSelectedGroups:function(h){var e=[];this.selectedGroups=e;var g=this.display;g.groupSelect.innerHTML="";var f=this.selectedGroup;WireIt.GroupUtils.getOuterGroup(h,function(j){var i=WireIt.cn("option",{value:"N"+e.length},{},"N"+e.length);e.push(j);g.groupSelect.appendChild(i);if(f==j){i.selected=true}})},showGroupConfigure:function(h,g){if(!d.isValue(h)||d.isValue(h.groupContainer)){hideGroupConfigure()}else{var e=this;var f=h.generateUI(g,function(){e.setGroupOptions.call(e)});this.setDisplay(f.listRows);this.setSelectedGroup(h);this.display.containerUIMap=f.containerUIMap;this.display.groupUIMap=f.groupUIMap;h.events.stateChanged.subscribe(function(){this.deselectGroup();this.hideGroupConfigure()},this,true);this.display.mainDiv.style.display="block"}},hideGroupConfigure:function(){this.display.mainDiv.style.display="none"},setSelectedGroup:function(e){this.deselectGroup();this.selectedGroup=e;WireIt.GroupUtils.applyToContainers(this.selectedGroup,true,function(f){f.highlight()})},deselectGroup:function(){if(d.isValue(this.selectedGroup)){WireIt.GroupUtils.applyToContainers(this.selectedGroup,true,function(e){e.dehighlight()})}this.selectedGroup=null},rubberbandSelect:function(){for(var f in this.layer.containers){var j=this.layer.containers[f];var h=this.getContainerCorners(j);var e=true;for(var g in h){e&=this.rubberband.pointIsInside(h[g].x,h[g].y)}if(e){this.addContainer(j)}}},getContainerCorners:function(e){var i=e.el.offsetTop;var f=i+e.el.offsetHeight;var h=e.el.offsetLeft;var g=h+e.el.offsetWidth;return[{x:h,y:i},{x:h,y:f},{x:g,y:i},{x:g,y:f}]}}})();(function(){var b=YAHOO.util,e=YAHOO.lang;var c=b.Dom,a=b.Event,d="WireIt-";WireIt.GroupFormContainer=function(f,g){WireIt.GroupFormContainer.superclass.constructor.call(this,f,g);this.getBaseConfig=this.options.getBaseConfigFunction;this.positionTerminals()};YAHOO.lang.extend(WireIt.GroupFormContainer,WireIt.FormContainer,{setOptions:function(f){WireIt.GroupFormContainer.superclass.setOptions.call(this,f);this.options.getBaseConfigFunction=f.getBaseConfigFunction;this.options.groupConfig=f.groupConfig},render:function(){WireIt.GroupFormContainer.superclass.render.call(this);this.renderExpand()},positionTerminals:function(){var l={};for(var u in this.options.terminals){var v=this.options.terminals[u];var f=v.side;if(!e.isValue(f)){f="top"}if(!e.isArray(l[f])){l[f]=[]}l[f].push(v)}var s=30;var x=function(i){return s*(i-1)};var g=function(D,B,y){var i=x(B);var A=i/2;var C=y/2;C-=A-D*s;var z=s/2;return C-z};var q=this.el.offsetHeight;var r=this.el.offsetWidth;var o=Math.max(WireIt.GroupUtils.valueOr(l.top,[]).length,WireIt.GroupUtils.valueOr(l.bottom,[]).length);var m=Math.max(WireIt.GroupUtils.valueOr(l.left,[]).length,WireIt.GroupUtils.valueOr(l.right,[]).length);if(q<x(m)){this.bodyEl.style.minHeight=new String(x(m))+"px";q=this.el.offsetHeight}if(r<x(o)){this.bodyEl.style.minWidth=new String(x(o))+"px";r=this.el.offsetWidth}for(var f in l){var n=l[f];var k=n.length;var t,h,p;if(f=="left"||f=="right"){t="top";p=q}else{t="left";p=r}h=f;for(var u=0;u<k;u++){var w=this.getTerminal(n[u].name);var j=new Object();j[h]=-15;j[t]=new String(g(u,k,p));w.setPosition(j)}}},renderExpand:function(){this.unGroupButton=WireIt.cn("div",{className:"WireIt-Container-ungroupbutton"});a.addListener(this.unGroupButton,"click",this.expand,this,true);this.ddHandle.appendChild(this.unGroupButton)},expand:function(){var y=function(m,g){return parseInt(m)+parseInt(g)};var j=this.layer.containers.length;var A=this.getConfig();var C=[A.position[0],A.position[1]];var x=[];for(var r in this.options.groupConfig.modules){var t=this.options.groupConfig.modules[r];var p=this.getBaseConfig(t.name);var f=YAHOO.lang.JSON.parse(YAHOO.lang.JSON.stringify(t.config));YAHOO.lang.augmentObject(f,p);f.title=t.name;var h=this.translatePosition(f.position,C);f.position=h;var q=this.layer.addContainer(f);q.setValue(t.value);x.push(q)}var n=function(I,m){var H=m;if(!e.isValue(H)){H=new WireIt.Group(this.group.grouper,this.layer)}H.properties=I.properties;if(e.isValue(I.groupContainer)){H.groupContainer=x[I.groupContainer];H.groupContainer.group=H}else{H.containers=[];H.groups=[];for(var D in I.containers){var G=I.containers[D];var F=x[G.container];H.containers.push({container:F,overrides:G.overrides});F.group=this.group}for(var J in I.groups){var w=I.groups[J];var E=n.call(this,w.group);H.groups.push({group:E,overrides:w.overrides});E.group=this.group}}return H};var l=n.call(this,this.options.groupConfig.group,this.group);var k=function(D,g){for(var w in D){var m=D[w];if(m.options.name==g){return m}}};var s=this;var u=function(D,m,F){for(var H in D.wires){var g=D.wires[H];var G={};var E={moduleId:y(j,m),terminal:F};if(g.terminal1==D){G.src=E;G.tgt={moduleId:s.layer.containers.indexOf(g.terminal2.container),terminal:g.terminal2.options.name}}else{G.tgt=E;G.src={moduleId:s.layer.containers.indexOf(g.terminal1.container),terminal:g.terminal1.options.name}}s.layer.addWire(G)}};var z=function(D,g,w){for(var G in D.fields){var F=D.fields[G];var H=s.form.inputsNames[G];var E=g(F.containerId,F.name);E.setValue(H.getValue());if(e.isObject(H.terminal)){u(H.terminal,y(w,F.containerId),F.name)}}for(var m in D.terminals){var I=D.terminals[m];var J=k(s.terminals,m);u(J,y(w,I.containerId),I.name)}};z(this.options.groupConfig.map.containerMap,function(m,g){return l.containers[m].container.form.inputsNames[g]},0);z(this.options.groupConfig.map.groupMap,function(m,g){return l.groups[m].group.groupContainer.form.inputsNames[g]},l.containers.length);for(var B in this.options.groupConfig.wires){var o=this.options.groupConfig.wires[B];this.layer.addWire({src:{moduleId:y(j,o.src.moduleId),terminal:o.src.terminal},tgt:{moduleId:y(j,o.tgt.moduleId),terminal:o.tgt.terminal}})}this.layer.removeContainer(this);this.group.groupContainer=null;var i=0;for(i=0;i<l.groups.length;i++){var v=l.groups[i].group;if(v.properties.expanded&&e.isValue(v.groupContainer)){v.groupContainer.expand()}}this.group.grouper.showGroup.call(this.group.grouper,this.group)},translatePosition:function(g,f){return[Math.max(0,g[0]+f[0]),Math.max(0,g[1]+f[1])]},getConfig:function(){var f=WireIt.GroupFormContainer.superclass.getConfig.call(this);e.augmentObject(f,{fields:this.options.fields,terminals:this.options.terminals,groupConfig:this.options.groupConfig});return f}})})();(function(){var c=YAHOO.util,g=YAHOO.lang;var b=c.Event,d=c.Dom,a=c.Connect,f=g.JSON,e=YAHOO.widget;WireIt.GroupUtils={applyToContainers:function(m,i,l,k){if(!g.isValue(k)){k=this}if(g.isValue(m.groupContainer)){l.call(k,m.groupContainer)}else{for(var j in m.containers){l.call(k,m.containers[j].container)}if(i){for(var h in m.groups){WireIt.GroupUtils.applyToContainers(m.groups[h].group,i,l,k)}}}},valueOr:function(h,i){return g.isValue(h)?h:i},removeGroupFromLayer:function(k,j){k.collapsing=true;if(g.isValue(k.groupContainer)){j.removeContainer(k.groupContainer)}else{for(var h in k.containers){j.removeContainer(k.containers[h])}for(var h in k.groups){WireIt.GroupUtils.removeGroupFromLayer(k.groups[h],j)}}k.collapsing=false},getOuterGroup:function(k,h){var i=k;var j=i;do{i=j;j=j.group;if(g.isFunction(h)){h(i)}}while(g.isValue(j));return i},addAllContainers:function(k,j){if(g.isObject(k.groupContainer)){j.push(k.groupContainer)}else{for(var i in k.containers){j.push(k.containers[i].container)}for(var h in k.groups){WireIt.GroupUtils.addAllContainers(k.groups[h].group,j)}}},serialiseGroup:function(m,l){var i={};i.properties={};g.augmentObject(i.properties,m.properties);if(g.isValue(m.groupContainer)){i.groupContainer=l.indexOf(m.groupContainer)}else{i.containers=[];i.groups=[];for(var j in m.containers){i.containers.push({container:l.indexOf(m.containers[j].container),overrides:m.containers[j].overrides})}for(var h in m.groups){var k=m.groups[h];i.groups.push({group:WireIt.GroupUtils.serialiseGroup(k.group,l),overrides:k.overrides})}}return i},getCollapsedConfig:function(k,j){if(!g.isObject(j)){j=WireIt.GroupUtils.getMap(k)}var l=[];var m=[];var i=function(v){for(var q in v){var t=v[q];for(var s in t.fields){var r=t.fields[s];if(r.visible){var n={};g.augmentObject(n,r.fieldConfig);n.name=r.externalName;n.label=r.externalName;g.augmentObject(n,r.fieldConfig);l.push(n)}}for(var p in t.terminals){var u=t.terminals[p];if(u.visible){var o={};o.name=u.externalName;o.side=u.side;g.augmentObject(o,u.terminalConfig);m.push(o)}}}};if(g.isValue(j.groupContainerMap)){i([j.groupContainerMap])}else{i(j.containerMap);i(j.groupMap)}var h=this.workOutCenter(k);return{fields:l,terminals:m,position:h,center:h}},workOutCenter:function(n){var l={};var m=function(p){var r,q;r=p[0];q=p[1];if((typeof l.left=="undefined")||l.left>r){l.left=r}if((typeof l.right=="undefined")||l.right<r){l.right=r}if((typeof l.top=="undefined")||l.top>q){l.top=q}if((typeof l.bottom=="undefined")||l.bottom<q){l.bottom=q}};if(g.isObject(n.groupContainer)){m(n.groupContainer.getConfig().position)}else{for(var j in n.containers){var o=n.containers[j].container;var i=o.getConfig();m(i.position)}for(var h in n.groups){var k=n.groups[h].group;m(WireIt.GroupUtils.workOutCenter(k))}}return[((l.right+l.left)/2),((l.top+l.bottom)/2)]},getExternalToInternalMap:function(h){var o={fields:{},terminals:{}};var i={fields:{},terminals:{}};for(var k in h.containerMap){var n=h.containerMap[k];for(var l in n.fields){var m=n.fields[l];if(m.visible){o.fields[m.externalName]={containerId:k,name:l}}}for(var j in n.terminals){var p=n.terminals[j];if(p.visible){o.terminals[p.externalName]={containerId:k,name:j}}}}for(var k in h.groupMap){var n=h.groupMap[k];for(var l in n.fields){var m=n.fields[l];if(m.visible){i.fields[m.externalName]={containerId:k,name:l}}}for(var j in n.terminals){var p=n.terminals[j];if(p.visible){i.terminals[p.externalName]={containerId:k,name:j}}}}return{containerMap:o,groupMap:i}},getOverridesFromUI:function(q,i){containerOverrides=[];groupOverrides=[];for(var l in q){var r=q[l];var s={fields:{},terminals:{}};for(var n in r.fields){var p=r.fields[n];var h={};h.visible=p.visible.checked;var j=p.externalName.value;if(j.length>0){h.rename=j}s.fields[n]=h}for(var k in r.terminals){var u=r.terminals[k];var h={};h.visible=u.visible.checked;var j=u.externalName.value;if(j.length>0){h.rename=j}h.side=u.side.value;s.terminals[k]=h}containerOverrides.push(s)}for(var v in i){var m=i[l];var s={fields:{},terminals:{}};for(var n in m.fields){var p=m.fields[n];var h={};h.visible=p.visible.checked;var j=p.externalName.value;if(j.length>0){h.rename=j}s.fields[n]=h}for(var k in m.terminals){var u=m.terminals[k];var h={};h.visible=u.visible.checked;var j=u.externalName.value;if(j.length>0){h.rename=j}h.side=u.side.value;s.terminals[k]=h}}return{containerOverrides:containerOverrides,groupOverrides:groupOverrides}},getMap:function(t){if(g.isValue(t.groupContainer)){var h={fields:[],terminals:[]};var k=function(u){return u==t.groupContainer};for(var l in t.groupContainer.form.inputConfigs){var r=t.groupContainer.form.inputConfigs[l];var o={};g.augmentObject(o,r);var n={fieldConfig:o};if(this.isFieldExternal(t.groupContainer.form.inputs[l],k)){n.externalName=r.name;n.visible=true}h.fields.push(n)}for(var m in t.groupContainer.options.terminals){var i=t.groupContainer.options.terminals[m];var s={terminalConfig:i};if(this.isTerminalExternal(t.groupContainer.terminals[m],k)){s.visible=true;s.externalName=i.name}h.terminals.push(s)}return{groupContainerMap:h}}var q={terminals:{},fields:{}};var p={};var j={};this.generateFieldMap(t,q,p,j);this.generateTerminalMap(t,q,p,j);this.generateDefaultFieldNames(p,q);this.generateDefaultFieldNames(j,q);this.generateDefaultTerminalNames(p,q);this.generateDefaultTerminalNames(j,q);return{containerMap:p,groupMap:j}},generateDefaultTerminalNames:function(l,h){for(var j in l){var m=l[j];for(var i in m.terminals){var k=m.terminals[i];if(k.visible&&!g.isValue(k.externalName)){k.externalName=this.generateFreshName(i,h.terminals);h.terminals[k.externalName]=true}}}},generateDefaultFieldNames:function(m,h){for(var i in m){var n=m[i];for(var l in n.fields){var k=n.fields[l];if(k.visible&&!g.isValue(k.externalName)){if(k.fieldConfig.wirable){var j={};g.augmentObject(j,h.fields);g.augmentObject(j,h.terminals);k.externalName=WireIt.GroupUtils.generateFreshName(l,j);h.fields[k.externalName]=true;h.terminals[k.externalName]=true}else{k.externalName=WireIt.GroupUtils.generateFreshName(l,h.fields);h.fields[k.externalName]=true}}}}},generateTerminalMap:function(l,i,x,v){var p=this;var q=function(H,K,J,I,F){for(var G in H){var L=H[G];var D=L.name;var E=K[D];var C={terminalConfig:L};if(g.isObject(E)&&E.visible){C.visible=true;if(g.isValue(E.rename)){if(g.isValue(J.terminals[E.rename])){throw {type:"MappingError",message:"Two identical terminal names specified ("+E.rename+")"}}J.terminals[E.rename]=true;C.externalName=E.rename}C.side=E.side}if(I(D)){C.visible=true;C.forceVisible=true}F[D]=C}};var B=[];WireIt.GroupUtils.addAllContainers(l,B);var y=function(C){for(var D in B){if(C==B[D]){return true}}return false};for(var h in l.containers){var j=l.containers[h];var z=j.container;var k=j.overrides;var m={};var u=g.isArray(z.options.terminals)?z.options.terminals:[];var t=function(C){var F;for(var E in z.terminals){var D=z.terminals[E];if(D.options.name==C){F=D;break}}return p.isTerminalExternal(F,y)};q(u,k.terminals,i,t,m,z.options.title);x[h].terminals=m}for(var o in l.groups){var r=l.groups[o];var w=r.group;var k=r.overrides;var s={};var A=WireIt.GroupUtils.getMap(w);var u=WireIt.GroupUtils.getCollapsedConfig(w,A).terminals;var t;if(g.isValue(w.groupContainer)){t=function(C){var F;for(var E in w.groupContainer.terminals){var D=w.groupContainer.terminals[E];if(D.options.name==C){F=D;break}}return p.isTerminalExternal(F,y)}}else{var n=WireIt.GroupUtils.getExternalToInternalMap(A);t=function(D){for(var C in n.containerMap.terminals){var H=n.containerMap.terminals[C];var G;for(var F in w.containers[H.containerId].terminals){var E=w.containers[H.containerId].terminals[F];if(E.options.name==D){G=E;break}}if(p.isTerminalExternal(G,y)){return true}}return false}}q(u,k.terminals,i,t,s);v[o].terminals=s}},isFieldExternal:function(i,h){if(g.isValue(i)){return this.isTerminalExternal(i.terminal,h)}},isTerminalExternal:function(j,i){if(g.isValue(j)){for(var k in j.wires){var h=j.wires[k];if((h.terminal1!=j&&!i(h.terminal1.container))||(h.terminal2!=j&&!i(h.terminal2.container))){return true}}}return false},generateFieldMap:function(m,i,w,u){var q=this;var A=[];WireIt.GroupUtils.addAllContainers(m,A);var x=function(B){for(var C in A){if(B==A[C]){return true}}return false};for(var h in m.containers){var k=m.containers[h];var y=k.container;var l=k.overrides;var n={};if(g.isObject(y.form)){var o=y.form.inputConfigs;var t=function(B){return q.isFieldExternal.call(q,y.form.inputsNames[B],x)};this.mergeFieldOverrides(o,l.fields,i,t,n)}w[h]={};w[h].fields=n}for(var p in m.groups){var r=m.groups[p];var v=r.group;var l=r.overrides;var s={};var z=WireIt.GroupUtils.getMap(v);var o=WireIt.GroupUtils.getCollapsedConfig(v,z).fields;var t;if(g.isValue(v.groupContainer)){t=function(B){return q.isFieldExternal.call(q,v.groupContainer.form.inputsNames[B],x)}}else{var j;j=function(C,G,F){if(!g.isValue(F)){F=WireIt.GroupUtils.getMap(G)}var B=WireIt.GroupUtils.getExternalToInternalMap(F);var D=B.containerMap.fields[C];if(g.isValue(D)){var E=G.containers[D.containerId].container.form.inputsNames[D.name];if(q.isFieldExternal.call(q,E,x)){return true}}else{var D=B.groupMap.fields[C];if(g.isValue(D)){return j(C,G.groups[D.containerId].group)}}return false};t=function(B){return j(B,v,z)}}this.mergeFieldOverrides(o,l.fields,i,t,s);u[p]={};u[p].fields=s}},generateFreshName:function(k,h){var m=function(i){return g.isValue(h[i])};var j=k;if(m(j)){var l=1;var n=j;do{j=n+l;l++}while(m(j))}h[j]=true;return j},mergeFieldOverrides:function(l,r,q,p,k){for(var m in l){var n=l[m];var i=n.name;var j=r[i];var h={fieldConfig:n};if(g.isObject(j)&&j.visible){h.visible=true;if(g.isValue(j.rename)){if(g.isValue(q.fields[j.rename])){throw {type:"MappingError",message:"Two identical field names specified ("+j.rename+")"}}q.fields[j.rename]=true;if(n.wirable){q.terminals[i]=true}h.externalName=j.rename}}if(p(i)){h.visible=true;h.forceVisible=true}k[i]=h}},generateFields:function(s,u,q){var w=[];var r=[];var t=[];var p={};var l=function(m,o){p[m]=true;if(o.wirable){t[m]=true}};for(var v in s){var z=s[v];for(var n in z){var A=z[n];var y=new String(v);var j=new String(A.name);var i=y+j+"";var x=u.fields[i];var C=q.fields[i];var B={};if(g.isObject(x)&&x.visible){if(g.isValue(x.rename)){var k={};g.augmentObject(k,A,{label:x.rename,name:x.rename});w.push(k);l(x.rename,A)}else{r.push(A)}}else{if(C){r.push(A)}}}}for(var n in r){var A=r[n];var h=this.generateNextName(A.name,p);l(h,A);var k={};g.augmentObject(k,A);k.name=h;w.push(k)}return{fields:w,usedTerminalNames:t}},generateTerminals:function(p,s,q,r){var u=[];var i=[];for(var v in p){var j=p[v];for(var k in j){var w=j[k];var h=s.terminals[v+w.name];var n=q.terminals[v+w.name];if(g.isObject(h)&&h.visible){if(g.isValue(h.rename)){var l={};g.augmentObject(l,w);l.name=h.rename;r[h.rename]=true;u.push(l)}else{i.push(w)}}else{if(n){i.push(w)}}}}for(var k in i){var w=i[k];var x=this.generateNextName(w.name,r);r[x]=true;var l={};g.augmentObject(l,w);l.name=x;u.push(l)}return u},generateNextName:function(k,h){var m=function(i){return g.isValue(h[i])};var j=k;if(m(j)){var l=1;var n=j;do{j=n+l;l++}while(m(j))}h[j]=true;return j},getExternalTerminalName:function(j,k,l,n){for(var i in terminalMap){var h=terminalMap[i];if(h.name==internalTerminal.options.name&&h.moduleId==internalModuleId){return i}}throw {type:"MappingError",message:"Couldn't find internal terminal's external name"}},fieldConfigsFromModules:function(l,j){var i={};for(var q in l){var k=l[q];var h={};g.augmentObject(h,k.config);g.augmentObject(h,j(k.name));if(g.isArray(h.fields)){var o=[];for(var n in h.fields){var p=h.fields[n];o.push(p)}i[q]=o}}return i},fieldConfigsFromContainers:function(l){var j={};for(var i in l){var n=l[i];if(g.isObject(n.form)){var h=[];for(var m in n.form.inputConfigs){var k=n.form.inputConfigs[m];h.push(k)}j[i]=h}}return j},terminalConfigsFromModules:function(l,j){var i={};for(var p in l){var k=l[p];var h={};g.augmentObject(h,k.config);g.augmentObject(h,j(k.name));if(g.isArray(h.terminals)){var o=[];for(var n in h.terminals){var q=h.terminals[n];o.push(q)}i[p]=o}}return i},getInternalModuleConfig:function(l,i){var k=[];for(var j in l){var m=l[j];var h=m.getConfig();h.position[0]=h.position[0]-i[0];h.position[1]=h.position[1]-i[1];k.push({name:m.options.title,value:m.getValue(),config:h})}return k},getWireConfig:function(k,i,h){var l=[];var j=[];this.addWireConfig(k,i,h,l,j);return{external:l,internal:j}},addWireConfig:function(n,m,i,r,q,o){var l=function(x,v){var u=false;var y;for(var t in x){y=x[t];if(y.src.moduleId==v.src.moduleId&&y.tgt.moduleId==v.tgt.moduleId&&y.src.terminal==v.src.terminal&&y.tgt.terminal==v.tgt.terminal){u=true;break}}if(!u){x.push(v)}};var p=function(z,u){for(var x in z.wires){var C=z.wires[x];var B=m(C.terminal1.container);var t=m(C.terminal2.container);if(B!=-1&&t!=-1){l(q,{src:{moduleId:B,terminal:C.terminal1.options.name},tgt:{moduleId:t,terminal:C.terminal2.options.name}})}else{var y={};var A,v;if(B==-1){y.groupIsSource=false;A=C.terminal1;v=C.terminal2}else{y.groupIsSource=true;A=C.terminal2;v=C.terminal1}y.externalName=u(v.options.name);y.groupTerminal=v;y.externalTerminal=A;r.push(y)}}};if(!g.isValue(o)){o=0}if(g.isValue(n.groupContainer)){p(n.groupContainer,function(t){return i("group",o,t)})}else{for(var h in n.containers){var k=n.containers[h].container;p(k,function(t){return i("container",h,t)})}for(var s in n.groups){var j=n.groups[s].group;this.addWireConfig(j,m,i,r,q,parseInt(s)+o)}}},firstTestSucess:function(h,j){var i;for(i=0;i<h.length;i++){if(j(h[i])){return i}}return -1}}})();(function(){var c=YAHOO.util,g=YAHOO.lang;var b=c.Event,d=c.Dom,a=c.Connect,f=g.JSON,e=YAHOO.widget;WireIt.RubberBand=function(i){WireIt.RubberBand.superclass.constructor.call(this,i.layer.el);this.grouper=i;var h=this;this.scrollThreshold=150;this.scrollAmount=20;this.directions={};i.layer.el.addEventListener("mousemove",function(n){var m=h.grouper.layer.el;var l=m.getBoundingClientRect();var k=n.clientX-l.left;var j=n.clientY-l.top;h.lastX=k+m.scrollLeft;h.lastY=j+m.scrollTop;h.directions={};if(k<h.scrollThreshold){h.directions.left=true}else{if((l.right-n.clientX)<h.scrollThreshold){h.directions.right=true}}if(j<h.scrollThreshold){h.directions.up=true}else{if((l.bottom-n.clientY)<h.scrollThreshold){h.directions.down=true}}},false)};WireIt.RubberBand.defaultDelay=50;YAHOO.lang.extend(WireIt.RubberBand,WireIt.CanvasElement,{layerMouseDown:function(l){var k=this.grouper.layer.el;var j=k.getBoundingClientRect();var i=l.clientX-j.left;var h=l.clientY-j.top;if(i<k.clientWidth&&h<k.clientHeight){this.start()}},start:function(){this.show();this.SetCanvasRegion(0,0,this.grouper.layer.el.scrollWidth,this.grouper.layer.el.scrollHeight);var h=this.getContext();h.beginPath();h.moveTo(this.lastX,this.lastY);this.startX=this.lastX;this.startY=this.lastY;this.timer=YAHOO.lang.later(WireIt.RubberBand.defaultDelay,this,function(){this.nextPoint(this.lastX,this.lastY);this.scroll(this.directions)},0,true)},scroll:function(i){var h=this.grouper.layer.el;if(i.left){h.scrollLeft=Math.max(0,h.scrollLeft-this.scrollAmount)}else{if(i.right){h.scrollLeft=Math.min(h.scrollWidth,h.scrollLeft+this.scrollAmount)}}if(i.up){h.scrollTop=Math.max(0,h.scrollTop-this.scrollAmount)}else{if(i.down){h.scrollTop=Math.min(h.scrollHeight,h.scrollTop+this.scrollAmount)}}},finish:function(){if(g.isObject(this.timer)){this.timer.cancel();this.timer=null;var h=this.getContext();this.nextPoint(this.startX,this.startY);YAHOO.lang.later(1000,this,this.hide,0,false)}},hide:function(){if(!g.isValue(this.element.style)){this.element.style={}}this.element.style.display="none"},show:function(){if(!g.isValue(this.element.style)){this.element.style={}}this.element.style.display=""},nextPoint:function(i,j){if(g.isValue(i)&&g.isValue(j)){var h=this.getContext();h.lineCap="round";h.strokeStyle="green";h.lineWidth="3";h.lineTo(i,j);h.stroke()}},pointIsInside:function(h,i){return(this.getContext().isPointInPath(h,i))}})})();